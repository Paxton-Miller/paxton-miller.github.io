<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>操作系统第三章：内存</title>
    <link href="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/"/>
    <url>/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251212225429.png" class="" title="Pasted image 20251212225429.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251212225801.png" class="" title="Pasted image 20251212225801.png">4GB=4\*2^30\*Byte，即总共2的32次方个二进制位，就需要32位进行编址。<img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251212225448.png" class="" title="Pasted image 20251212225448.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251212225623.png" class="" title="Pasted image 20251212225623.png">2和3 的区别是，2全链接时全装入内存，即装入时动态链接，3按需，则是运行时动态链接<img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251212225503.png" class="" title="Pasted image 20251212225503.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251212225518.png" class="" title="Pasted image 20251212225518.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251212225534.png" class="" title="Pasted image 20251212225534.png"><h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251213123951.png" class="" title="Pasted image 20251213123951.png"><p>界地址寄存器判断逻辑地址；重定位寄存器判断实际物理地址</p><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251214160134.png" class="" title="Pasted image 20251214160134.png"><p>32位是指计算机用32二进制位编址，宏直接将值替换为指令</p><h3 id="内存空间的扩充"><a href="#内存空间的扩充" class="headerlink" title="内存空间的扩充"></a>内存空间的扩充</h3><p>ps，还有虚拟存储技术，在后文</p><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251214162046.png" class="" title="Pasted image 20251214162046.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251214162146.png" class="" title="Pasted image 20251214162146.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251214163212.png" class="" title="Pasted image 20251214163212.png"><h3 id="内存空间的分配与回收"><a href="#内存空间的分配与回收" class="headerlink" title="内存空间的分配与回收"></a>内存空间的分配与回收</h3><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251214171212.png" class="" title="Pasted image 20251214171212.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251214171337.png" class="" title="Pasted image 20251214171337.png"><p>碎片本质上是不匹配</p><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251216212015.png" class="" title="Pasted image 20251216212015.png"><h4 id="为什么高地址的大分区会被“消耗”？——扫描的均匀性导致“保护机制”丧失"><a href="#为什么高地址的大分区会被“消耗”？——扫描的均匀性导致“保护机制”丧失" class="headerlink" title="为什么高地址的大分区会被“消耗”？——扫描的均匀性导致“保护机制”丧失"></a>为什么高地址的大分区会被“消耗”？——扫描的均匀性导致“保护机制”丧失</h4><p>在 First Fit 中，低地址起到了“挡箭牌”的作用。大多数小进程请求在低地址就被消化了，这有效地<strong>保护了高地址的大分区</strong>，使它们能够保持完整，留给后来的特大进程。 而在 Next Fit 中，查找指针一直在向后移动。无论请求的大小，它都会顺着内存地址往后找。这意味着高地址的大分区会被平等地发现并用于满足各种中小型请求。</p><h3 id="基本分页存储管理"><a href="#基本分页存储管理" class="headerlink" title="基本分页存储管理"></a>基本分页存储管理</h3><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172023.png" class="" title="Pasted image 20251218172023.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172046.png" class="" title="Pasted image 20251218172046.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172059.png" class="" title="Pasted image 20251218172059.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172124.png" class="" title="Pasted image 20251218172124.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172136.png" class="" title="Pasted image 20251218172136.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172151.png" class="" title="Pasted image 20251218172151.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172217.png" class="" title="Pasted image 20251218172217.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172243.png" class="" title="Pasted image 20251218172243.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251218172259.png" class="" title="Pasted image 20251218172259.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219104808.png" class="" title="Pasted image 20251219104808.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219104955.png" class="" title="Pasted image 20251219104955.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219105011.png" class="" title="Pasted image 20251219105011.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219105027.png" class="" title="Pasted image 20251219105027.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219105100.png" class="" title="Pasted image 20251219105100.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219161408.png" class="" title="Pasted image 20251219161408.png"><p>Cache：高速缓存；访存：访问内存；进程切换自动清理快表</p><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219161541.png" class="" title="Pasted image 20251219161541.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219161611.png" class="" title="Pasted image 20251219161611.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219161642.png" class="" title="Pasted image 20251219161642.png"><p>为什么快表快？</p><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251219161716.png" class="" title="Pasted image 20251219161716.png"><h3 id="单级页表存在的问题"><a href="#单级页表存在的问题" class="headerlink" title="单级页表存在的问题"></a>单级页表存在的问题</h3><p>最大需要多少字节&#x2F;页框存储页表？<br>假设以下条件：<br>操作系统用32位表示内存地址，页框大小为4KB，页表项长度4B。<br>则页面大小 &#x3D; 4KB &#x3D; 2<sup>12</sup>B，则用12位表示页内地址，剩下20位表示页号。<br>则一个用户进程最多有2<sup>20</sup>个页表项，每个页表项长度4B，总页表长度 &#x3D; 2<sup>22</sup>B，即2<sup>22</sup>&#x2F;2<sup>12</sup>&#x3D;2<sup>10</sup>个页框</p><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226144452.png" class="" title="Pasted image 20251226144452.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226144630.png" class="" title="Pasted image 20251226144630.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226152236.png" class="" title="Pasted image 20251226152236.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226152310.png" class="" title="Pasted image 20251226152310.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226152330.png" class="" title="Pasted image 20251226152330.png"><h3 id="基本分段存储管理"><a href="#基本分段存储管理" class="headerlink" title="基本分段存储管理"></a>基本分段存储管理</h3><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226160935.png" class="" title="Pasted image 20251226160935.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226152821.png" class="" title="Pasted image 20251226152821.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226161035.png" class="" title="Pasted image 20251226161035.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226161228.png" class="" title="Pasted image 20251226161228.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226161253.png" class="" title="Pasted image 20251226161253.png"><h3 id="段页式管理"><a href="#段页式管理" class="headerlink" title="段页式管理"></a>段页式管理</h3><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226163258.png" class="" title="Pasted image 20251226163258.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226164025.png" class="" title="Pasted image 20251226164025.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226164040.png" class="" title="Pasted image 20251226164040.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226164058.png" class="" title="Pasted image 20251226164058.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226164117.png" class="" title="Pasted image 20251226164117.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251226163106.png" class="" title="Pasted image 20251226163106.png"><p>思考：为什么分页管理是一维的，分段管理是二维的？段页式管理也是二维的？<br>思考：为什么段表项中不存储段表始址？</p><h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230164925.png" class="" title="Pasted image 20251230164925.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230171215.png" class="" title="Pasted image 20251230171215.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230171255.png" class="" title="Pasted image 20251230171255.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230171320.png" class="" title="Pasted image 20251230171320.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230171353.png" class="" title="Pasted image 20251230171353.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230171229.png" class="" title="Pasted image 20251230171229.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230210814.png" class="" title="Pasted image 20251230210814.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230211006.png" class="" title="Pasted image 20251230211006.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230211023.png" class="" title="Pasted image 20251230211023.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230211039.png" class="" title="Pasted image 20251230211039.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230211054.png" class="" title="Pasted image 20251230211054.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251230211112.png" class="" title="Pasted image 20251230211112.png"><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251231100418.png" class="" title="Pasted image 20251231100418.png"><p>预调页，调一批</p><img src="/2025/12/31/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E5%86%85%E5%AD%98/Pasted%20image%2020251231102329.png" class="" title="Pasted image 20251231102329.png"><p>传统，需要seek、read等指针<br>内存映射文件：操作系统负责读写，多个进程可以通过自己的虚拟地址空间，通过页表对应实际的物理内存<br>需要注意的是，操作系统并不是真的创建了一大批占用内存的空间，虚拟地址空间只是记了一笔账，真正读写时通过页表记录实际的物理内存块</p>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>八股文</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>操作系统第二章：同步、互斥、死锁</title>
    <link href="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/"/>
    <url>/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h2 id="同步、互斥"><a href="#同步、互斥" class="headerlink" title="同步、互斥"></a>同步、互斥</h2><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251210145631.png" class="" title="Pasted image 20251210145631.png">我们把一段时间内只允许一个进程访问的资源称为临界资源<h2 id="互斥实现方法"><a href="#互斥实现方法" class="headerlink" title="互斥实现方法"></a>互斥实现方法</h2><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251210155645.png" class="" title="Pasted image 20251210155645.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251210155711.png" class="" title="Pasted image 20251210155711.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251210155741.png" class="" title="Pasted image 20251210155741.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251210155809.png" class="" title="Pasted image 20251210155809.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251210155826.png" class="" title="Pasted image 20251210155826.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211144203.png" class="" title="Pasted image 20251211144203.png"><h3 id="TSL（Test-and-Set-Lock）指令"><a href="#TSL（Test-and-Set-Lock）指令" class="headerlink" title="TSL（Test-and-Set Lock）指令"></a><strong>TSL（Test-and-Set Lock）指令</strong></h3><p>作用：<br><strong>原子地把某个内存单元设置为 1，并返回它原来的值。</strong></p><p>用途：</p><ul><li><p>实现<strong>忙等待锁（spinlock）</strong></p></li><li><p>判断锁是否已被占用</p></li><li><p>依赖硬件保证“一气呵成”，不会被中断</p></li></ul><p>示例行为：</p><p><code>old = *lock *lock = 1 return old</code></p><p>如果返回的 old 为 0 → 你获取到了锁<br>如果是 1 → 锁已被占用</p><hr><h3 id="Swap-指令（交换指令）"><a href="#Swap-指令（交换指令）" class="headerlink" title="Swap 指令（交换指令）"></a><strong>Swap 指令（交换指令）</strong></h3><p>作用：<br><strong>原子地交换内存变量和寄存器中的值。</strong></p><p>用途：</p><ul><li><p>也用于实现互斥锁</p></li><li><p>同样依赖硬件原子性</p></li></ul><p>示例行为：</p><p><code>temp = *lock *lock = register register = temp</code></p><p>常用方式：让寄存器事先装入“1”，用它与 lock 交换。<br>如果交换后 lock 原来是 0，你就拿到了锁；如果是 1，代表锁忙。</p><h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211150658.png" class="" title="Pasted image 20251211150658.png"><p>已学过的硬件&#x2F;软件实现方法都是自旋锁</p><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211150710.png" class="" title="Pasted image 20251211150710.png"><h2 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h2><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211170546.png" class="" title="Pasted image 20251211170546.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211170628.png" class="" title="Pasted image 20251211170628.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211170651.png" class="" title="Pasted image 20251211170651.png"><ul><li>wait&#x2F;P&#x2F;请求&#x2F;阻塞操作，判断value&lt;0，成立即阻塞；</li><li>signal&#x2F;V&#x2F;释放&#x2F;唤醒操作，判断value&lt;&#x3D;0，成立即唤醒；</li><li>能与之前进程状态转换串起来，阻塞原语、唤醒原语、PV操作；</li><li>记录型信号量唤醒原语并不是直接会使得等待队列的队头进程直接使用被等待的临界资源，而是会有阻塞态变为就绪态</li></ul><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211203841.png" class="" title="Pasted image 20251211203841.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211204028.png" class="" title="Pasted image 20251211204028.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211204052.png" class="" title="Pasted image 20251211204052.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211204109.png" class="" title="Pasted image 20251211204109.png"><h3 id="生产者与消费者问题"><a href="#生产者与消费者问题" class="headerlink" title="生产者与消费者问题"></a>生产者与消费者问题</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211211932.png" class="" title="Pasted image 20251211211932.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211211853.png" class="" title="Pasted image 20251211211853.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251211211913.png" class="" title="Pasted image 20251211211913.png"><p>为什么互斥P一定在同步P之后？如果互斥P在同步P之前的话，后面还有一个同步P可能导致阻塞，陷入死锁</p><h3 id="多生产者与多消费者问题"><a href="#多生产者与多消费者问题" class="headerlink" title="多生产者与多消费者问题"></a>多生产者与多消费者问题</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212102822.png" class="" title="Pasted image 20251212102822.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212102858.png" class="" title="Pasted image 20251212102858.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212102918.png" class="" title="Pasted image 20251212102918.png"><h3 id="读者写者问题"><a href="#读者写者问题" class="headerlink" title="读者写者问题"></a>读者写者问题</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212111553.png" class="" title="Pasted image 20251212111553.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212111616.png" class="" title="Pasted image 20251212111616.png"><p>读者-写者问题为我们解决复杂的互斥问题提供了一个参考思路。其核心思想在于设置了一个计数器count用来记录当前正在访问共享文件的读进程数（共享锁？）。我们可以用count 的值来判断当前进入的进程是否是第一个&#x2F;最后一个读进程，从而做出不同的处理。另外，对count变量的检查和赋值不能一气呵成导致了一些错误，如果需要实现应该想到用互斥信号量。<br>P（W）本质上是限制加共享锁</p><h3 id="哲学家进餐问题"><a href="#哲学家进餐问题" class="headerlink" title="哲学家进餐问题"></a>哲学家进餐问题</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212125808.png" class="" title="Pasted image 20251212125808.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212125837.png" class="" title="Pasted image 20251212125837.png"><p>哲学家进餐问题的关键在于解决进程死锁。这些进程之间只存在<strong>互斥</strong>关系，但是与之前接触到的互斥关系不同的是，每个进程都需要同时持有<strong>两个临界资源</strong>，因此就有“死锁”问题的隐患。<br>如果在考试中遇到了一个进程需要同时持有多个临界资源的情况，应该参考哲学家问题的思想，分析题中给出的进程之间是否会发生循环等待，是否会发生死锁。可以参考哲学家就餐问题解决死锁的三种思路。</p><h3 id="管程"><a href="#管程" class="headerlink" title="管程"></a>管程</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212144815.png" class="" title="Pasted image 20251212144815.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212144833.png" class="" title="Pasted image 20251212144833.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212144852.png" class="" title="Pasted image 20251212144852.png"><h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212155128.png" class="" title="Pasted image 20251212155128.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212161447.png" class="" title="Pasted image 20251212161447.png"><p>SPOOLing在逻辑上把互斥资源表现为共享资源。</p><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212171406.png" class="" title="Pasted image 20251212171406.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212171029.png" class="" title="Pasted image 20251212171029.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212171226.png" class="" title="Pasted image 20251212171226.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212205414.png" class="" title="Pasted image 20251212205414.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%90%8C%E6%AD%A5%E3%80%81%E4%BA%92%E6%96%A5%E3%80%81%E6%AD%BB%E9%94%81/Pasted%20image%2020251212205441.png" class="" title="Pasted image 20251212205441.png">]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>八股文</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>操作系统第二章：调度</title>
    <link href="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/"/>
    <url>/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/</url>
    
    <content type="html"><![CDATA[<h2 id="作业-内存-进程的调度"><a href="#作业-内存-进程的调度" class="headerlink" title="作业&#x2F;内存&#x2F;进程的调度"></a>作业&#x2F;内存&#x2F;进程的调度</h2><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251208203938.png" class="" title="Pasted image 20251208203938.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251208210042.png" class="" title="Pasted image 20251208210042.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251208210100.png" class="" title="Pasted image 20251208210100.png">狭义调度：选进程；广义调度：选进程并切换<img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251208212923.png" class="" title="Pasted image 20251208212923.png"><p>闲逛进程：没事干，CPU得有事情干。优先级最低，每个指令周期末尾会检查中断，如果有中断，即唤醒调度程序<br><strong>外中断只在“指令执行完后”检查一次。</strong><br><strong>内中断在“指令执行过程中随时可能触发”，并不需要等待指令执行完。</strong></p><h2 id="调度算法"><a href="#调度算法" class="headerlink" title="调度算法"></a>调度算法</h2><h3 id="调度算法指标"><a href="#调度算法指标" class="headerlink" title="调度算法指标"></a>调度算法指标</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251208221902.png" class="" title="Pasted image 20251208221902.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251208222026.png" class="" title="Pasted image 20251208222026.png"><h3 id="批处理系统调度算法"><a href="#批处理系统调度算法" class="headerlink" title="批处理系统调度算法"></a>批处理系统调度算法</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251209225023.png" class="" title="Pasted image 20251209225023.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251209225044.png" class="" title="Pasted image 20251209225044.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251209225105.png" class="" title="Pasted image 20251209225105.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251209225124.png" class="" title="Pasted image 20251209225124.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251209225142.png" class="" title="Pasted image 20251209225142.png"><h3 id="交互式系统调度算法"><a href="#交互式系统调度算法" class="headerlink" title="交互式系统调度算法"></a>交互式系统调度算法</h3><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251210123256.png" class="" title="Pasted image 20251210123256.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251210123351.png" class="" title="Pasted image 20251210123351.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251210123438.png" class="" title="Pasted image 20251210123438.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251210123459.png" class="" title="Pasted image 20251210123459.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251210123529.png" class="" title="Pasted image 20251210123529.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251210124022.png" class="" title="Pasted image 20251210124022.png"><img src="/2025/12/12/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%B0%83%E5%BA%A6/Pasted%20image%2020251210143906.png" class="" title="Pasted image 20251210143906.png">]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>八股文</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>操作系统第二章：进程、线程与IPC</title>
    <link href="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/"/>
    <url>/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/</url>
    
    <content type="html"><![CDATA[<h2 id="进程的概念、组成、转换"><a href="#进程的概念、组成、转换" class="headerlink" title="进程的概念、组成、转换"></a>进程的概念、组成、转换</h2><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251201110143.png" class="" title="Pasted image 20251201110143.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251201110041.png" class="" title="Pasted image 20251201110041.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251201211638.png" class="" title="Pasted image 20251201211638.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251201211617.png" class="" title="Pasted image 20251201211617.png"><h2 id="进程转换"><a href="#进程转换" class="headerlink" title="进程转换"></a>进程转换</h2><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202103129.png" class="" title="Pasted image 20251202103129.png"><p>原子性是防止操作系统管理混乱</p><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202103528.png" class="" title="Pasted image 20251202103528.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202103558.png" class="" title="Pasted image 20251202103558.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202103616.png" class="" title="Pasted image 20251202103616.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202103701.png" class="" title="Pasted image 20251202103701.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202103725.png" class="" title="Pasted image 20251202103725.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202104805.png" class="" title="Pasted image 20251202104805.png"><h2 id="进程通信IPC"><a href="#进程通信IPC" class="headerlink" title="进程通信IPC"></a>进程通信IPC</h2><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202172901.png" class="" title="Pasted image 20251202172901.png"><p>三大类：共享存储（低级、高级）、消息传递（直接、间接）、管道通信<br><strong>共享存储</strong>：基于存储区的共享开辟了一片共享存储空间，并映射到各自进程的虚拟地址空间，访问比较自由，位置随意。互斥访问：P&#x2F;V，可多个读，不可多个同时写；基于数据结构的共享，例如开辟了一个int a[10]。<br>消息传递：<img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202192441.png" class="" title="Pasted image 20251202192441.png"><br>进程控制块（PCB）和大多数核心的操作系统数据结构，都存放在操作系统内核地址空间中<img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202192508.png" class="" title="Pasted image 20251202192508.png"><br><strong>间接通信</strong>怎么实现A到B发消息？创建一个专属于B监听的信箱即可<br><strong>管道通信</strong>：内存缓冲区，与共享存储的区别在于，它是循环队列FIFO，必须按顺序来。互斥访问，同时写引发挂起。读后数据就没了。读空和写空都阻塞。</p><h2 id="信号（IPC的另一种形式）"><a href="#信号（IPC的另一种形式）" class="headerlink" title="信号（IPC的另一种形式）"></a>信号（IPC的另一种形式）</h2><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202210141.png" class="" title="Pasted image 20251202210141.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202210346.png" class="" title="Pasted image 20251202210346.png"><h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202211612.png" class="" title="Pasted image 20251202211612.png"><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202211626.png" class="" title="Pasted image 20251202211626.png"><p>注意，同一进程内的不同线程间共享进程的系统资源</p><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202213539.png" class="" title="Pasted image 20251202213539.png"><p>用户级线程本质上还是一个进程，用线程库实现的逻辑上的多线程，例如while循环依次执行视频聊天、文字聊天、文件传输。易阻塞</p><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202213639.png" class="" title="Pasted image 20251202213639.png"><h3 id="高级编程语言中的线程实践（应用-OS层面）"><a href="#高级编程语言中的线程实践（应用-OS层面）" class="headerlink" title="高级编程语言中的线程实践（应用+OS层面）"></a>高级编程语言中的线程实践（应用+OS层面）</h3><table><thead><tr><th>语言&#x2F;环境</th><th>线程类型</th><th>模型</th><th>行为特性</th></tr></thead><tbody><tr><td><strong>Java</strong> (JVM)</td><td>内核级线程 (KLT)</td><td><strong>一对一</strong></td><td>充分利用多核 CPU，适用于 CPU 密集型和 I&#x2F;O 密集型任务。</td></tr><tr><td><strong>C&#x2F;C++</strong> (pthreads, std::thread)</td><td>内核级线程 (KLT)</td><td><strong>一对一</strong></td><td>直接暴露操作系统线程，性能高，完全并行，但编程复杂。</td></tr><tr><td><strong>Python</strong> (threading, <strong>CPython</strong>)</td><td>内核级线程 (KLT)</td><td><strong>近似多对一</strong></td><td>线程本身是 KLT，但 GIL 限制了同一时间只有一个线程执行 Python 字节码，无法并行执行 CPU 密集型任务。</td></tr><tr><td><strong>Go</strong> (Goroutines)</td><td>多线程模型 (m:n)</td><td><strong>多对多</strong></td><td>Goroutines 非常轻量级，可以在少数 OS 线程上实现高并发和高性能的 I&#x2F;O 密集型服务。</td></tr><tr><td><strong>Node.js</strong>(Async&#x2F;Await)</td><td>依赖<strong>事件循环</strong></td><td><strong>无线程</strong></td><td>Node.js 是单线程模型，通过异步 I&#x2F;O 和回调机制模拟高并发，避免了线程管理开销。</td></tr></tbody></table><h4 id="机制解析：Go-的-M-N-模型"><a href="#机制解析：Go-的-M-N-模型" class="headerlink" title="机制解析：Go 的 M:N 模型"></a>机制解析：Go 的 M:N 模型</h4><ul><li><p><strong>Goroutine (G) 是 ULT：</strong> Goroutine 由 Go 运行时（Runtime）管理，而非操作系统内核。它的创建、销毁和切换都在用户空间完成，因此<strong>极快且开销极低</strong>（仅需几 KB 的栈空间）。</p></li><li><p><strong>操作系统线程 (M) 是 KLT：</strong> 操作系统线程（通常是 pthreads）由操作系统内核管理。</p></li><li><p><strong>逻辑处理器 (P) 是中介：</strong> Go 运行时使用 P 来将 G 绑定到 M 上。P 的数量通常等于 CPU 核心数。</p></li></ul><p><strong>核心原因：为了极高的并发性（Concurrency）和可扩展性。</strong></p><ol><li><p><strong>极低开销：</strong> Go 可以轻松创建数十万甚至数百万个 Goroutine，这是传统的<strong>一对一</strong>内核级线程模型（如 Java或 C++ 默认线程）无法承受的。</p></li><li><p><strong>避免阻塞：</strong> 如果一个 Goroutine 发起阻塞的系统调用（例如 I&#x2F;O），Go 运行时会检测到这个 M 线程即将阻塞。它会：</p><ul><li><p>将该 Goroutine 从 M 上<strong>解绑</strong>，让 M 带着这个 Goroutine 去阻塞。</p></li><li><p>将 M 上的 P <strong>转移</strong>给一个新的、非阻塞的 M 线程。</p></li><li><p>将<strong>其他等待运行的 Goroutine</strong> 调度到这个新的 M 上运行。</p></li></ul></li></ol><p>这个过程被称为 <strong>Goroutine 抢占式调度</strong>，它避免了一个 Goroutine 阻塞导致整个进程停顿的问题，同时保持了高效的用户态线程管理。</p><h4 id="机制解析：Node-js-的-单线程-模型"><a href="#机制解析：Node-js-的-单线程-模型" class="headerlink" title="机制解析：Node.js 的 单线程 模型"></a>机制解析：Node.js 的 单线程 模型</h4><h5 id="1-JavaScript-线程（单线程）"><a href="#1-JavaScript-线程（单线程）" class="headerlink" title="1. JavaScript 线程（单线程）"></a>1. JavaScript 线程（单线程）</h5><p>这是 Node.js 的核心。负责执行所有用户编写的 JavaScript 代码、事件循环（Event Loop）以及回调函数。</p><ul><li><p><strong>执行环境：</strong> 运行在 V8 引擎中，它是严格的<strong>单线程</strong>。</p></li><li><p><strong>模型归类：</strong> Node.js 宣称的单线程模型指的就是这个 <strong>JavaScript 主线程</strong>。这个线程决定了你的代码不能有耗时的同步阻塞操作。</p></li></ul><h5 id="2-libuv-线程池（多线程-KLT）"><a href="#2-libuv-线程池（多线程-KLT）" class="headerlink" title="2. libuv 线程池（多线程 &#x2F; KLT）"></a>2. libuv 线程池（多线程 &#x2F; KLT）</h5><p>libuv 库是 Node.js 的核心依赖，它负责处理所有的异步 I&#x2F;O 操作。</p><ul><li><p><strong>线程池作用：</strong> libuv 维护了一个<strong>内部线程池</strong>（通常有 4 个 KLT），用于处理那些<strong>操作系统没有提供原生异步接口</strong>的操作，例如：</p><ul><li><p><strong>文件系统 I&#x2F;O</strong>（如 fs.readFile）</p></li><li><p><strong>DNS 查询</strong></p></li><li><p><strong>耗时的 CPU 密集型任务</strong>（尽管不推荐，但 libuv 线程池可以用来处理）</p></li></ul></li><li><p><strong>通信方式：</strong> 当 JavaScript 主线程发起一个文件读取请求时，它将任务委托给 libuv 线程池中的一个 KLT执行，然后 JavaScript 线程立即返回。任务完成后，KLT 通过<strong>队列</strong>将结果通知事件循环，事件循环再执行相应的 JavaScript 回调函数。</p></li></ul><img src="/2025/12/10/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E4%B8%8EIPC/Pasted%20image%2020251202220241.png" class="" title="Pasted image 20251202220241.png">]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>八股文</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>记一次校园网 K8S 集群内网穿透之旅：从 Cloudflare 到 FRP + Nginx</title>
    <link href="/2025/12/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%A0%A1%E5%9B%AD%E7%BD%91-K8S-%E9%9B%86%E7%BE%A4%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E4%B9%8B%E6%97%85%EF%BC%9A%E4%BB%8E-Cloudflare-%E5%88%B0-FRP-Nginx/"/>
    <url>/2025/12/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%A0%A1%E5%9B%AD%E7%BD%91-K8S-%E9%9B%86%E7%BE%A4%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E4%B9%8B%E6%97%85%EF%BC%9A%E4%BB%8E-Cloudflare-%E5%88%B0-FRP-Nginx/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近手里有一个部署在校园网内部 K8S 集群上的项目（Satellite Micro）。环境很典型：服务器有教育网 IP（<code>223.2.x.x</code>），出站流量虽然有些限制但基本能通，但入站流量被学校防火墙像铁桶一样挡在外面。</p><p>为了让外网（或者说在北京的领导们）能访问到 K8S 里的前端和 API，我开始了一场内网穿透的折腾之旅。</p><h2 id="第一阶段：尝试-Cloudflare-Tunnel（以失败告终）"><a href="#第一阶段：尝试-Cloudflare-Tunnel（以失败告终）" class="headerlink" title="第一阶段：尝试 Cloudflare Tunnel（以失败告终）"></a>第一阶段：尝试 Cloudflare Tunnel（以失败告终）</h2><p>最开始我想用 Cloudflare Tunnel (Zero Trust)，毕竟它是云原生方案，不需要自己买 VPS，而且配置起来显得很“现代化”。</p><h3 id="1-部署尝试"><a href="#1-部署尝试" class="headerlink" title="1. 部署尝试"></a>1. 部署尝试</h3><p>我用的是Cloudflare官网的Zero Trust，需要在网络里新建连接器，也即tunnel，另在 K8S 里部署了 <code>cloudflared</code> 的 Deployment，配置了 Token。理论上，它应该主动向 Cloudflare 边缘节点发起连接，建立隧道。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>  <br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>  <br><span class="hljs-attr">metadata:</span>  <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">cloudflare</span>  <br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">satellite-micro</span>  <br>  <span class="hljs-attr">labels:</span>  <br>    <span class="hljs-attr">app:</span> <span class="hljs-string">cloudflare</span>  <br><span class="hljs-attr">spec:</span>  <br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 只有1个副本也够用，生产环境可以设为2  </span><br>  <span class="hljs-attr">selector:</span>  <br>    <span class="hljs-attr">matchLabels:</span>  <br>      <span class="hljs-attr">app:</span> <span class="hljs-string">cloudflare</span>  <br>  <span class="hljs-attr">template:</span>  <br>    <span class="hljs-attr">metadata:</span>  <br>      <span class="hljs-attr">labels:</span>  <br>        <span class="hljs-attr">app:</span> <span class="hljs-string">cloudflare</span>  <br>    <span class="hljs-attr">spec:</span>  <br>      <span class="hljs-attr">containers:</span>  <br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">cloudflare</span>  <br>        <span class="hljs-attr">image:</span> <span class="hljs-number">223.2</span><span class="hljs-number">.44</span><span class="hljs-number">.251</span><span class="hljs-string">/satellite/cloudflare:latest</span>  <br>        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span>  <br>        <span class="hljs-attr">args:</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">tunnel</span>  <br>        <span class="hljs-comment"># 必须加上这个，防止容器尝试自动升级导致权限问题  </span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--no-autoupdate</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">run</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--protocol</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">http2</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">--token</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-string">eyJhIjoiNTRiYWRhYTRkYjUxZmNlYTJiNDlmYjgxZDM0MWNkM2QiLCJ0IjoiYmZhNDk3OWYtOWE1OC00YzBhLTgyNjAtYTgyYWYyNjY3Y2Q5IiwicyI6Ik4yTTVNRE5oT1RZdFlURTRZUzAwWkdOa0xXSmlORGd0TjJZMFpqVXpaRGMwWlRobCJ9</span>  <br>        <span class="hljs-attr">env:</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">TUNNEL_PROTOCOL</span>  <br>          <span class="hljs-attr">value:</span> <span class="hljs-string">http2</span>  <br>        <span class="hljs-attr">resources:</span>  <br>          <span class="hljs-attr">requests:</span>  <br>            <span class="hljs-attr">cpu:</span> <span class="hljs-string">10m</span>  <br>            <span class="hljs-attr">memory:</span> <span class="hljs-string">64Mi</span>  <br>          <span class="hljs-attr">limits:</span>  <br>            <span class="hljs-attr">cpu:</span> <span class="hljs-string">500m</span>  <br>            <span class="hljs-attr">memory:</span> <span class="hljs-string">256Mi</span>  <br>      <span class="hljs-attr">restartPolicy:</span> <span class="hljs-string">Always</span><br></code></pre></td></tr></table></figure><h3 id="2-遇到的坑"><a href="#2-遇到的坑" class="headerlink" title="2. 遇到的坑"></a>2. 遇到的坑</h3><p>Pod 启动后，日志直接红了一片：</p><ul><li><p><strong>UDP 被拦：</strong> 起初报错 <code>failed to dial to edge with quic</code>。这是因为 Cloudflare 默认使用 QUIC (基于 UDP) 协议，而校园网防火墙对 UDP 并不友好。</p></li><li><p><strong>改用 TCP 依然跪：</strong> 我通过环境变量 <code>TUNNEL_PROTOCOL: http2</code> 强制它走 TCP。结果报错变成了 <code>dial tcp 198.41.200.193:7844: i/o timeout</code>。</p></li></ul><h3 id="3-放弃原因"><a href="#3-放弃原因" class="headerlink" title="3. 放弃原因"></a>3. 放弃原因</h3><p>经过排查发现，Cloudflare Tunnel 建立连接需要访问边缘节点的 <strong>7844</strong> 端口。然而，严苛的教育网防火墙似乎只放行了标准的 80&#x2F;443 端口，7844 这种非标端口直接被掐断了。</p><p>虽然心有不甘，但“网络层物理封锁”难以逾越，遂放弃 CF 方案。</p><hr><h2 id="第二阶段：回归-FRP-——-端口伪装与全链路打通"><a href="#第二阶段：回归-FRP-——-端口伪装与全链路打通" class="headerlink" title="第二阶段：回归 FRP —— 端口伪装与全链路打通"></a>第二阶段：回归 FRP —— 端口伪装与全链路打通</h2><p>既然免费的午餐吃不到，还是得靠自己。我有一台阿里云的 VPS（<code>114.55.x.x</code>），决定用 FRP 方案。为了骗过校园网防火墙，核心思路是：<strong>把 FRP 流量伪装成普通的 HTTPS 流量（走 443 端口）</strong>。</p><h3 id="1-VPS-服务端配置-frps"><a href="#1-VPS-服务端配置-frps" class="headerlink" title="1. VPS 服务端配置 (frps)"></a>1. VPS 服务端配置 (frps)</h3><p>为了防止被识别为非 HTTP 流量导致连接重置（EOF），我在服务端强制开启了 TLS。</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-comment"># frps.toml</span><br><span class="hljs-comment"># frps.toml  </span><br><span class="hljs-comment"># 服务端监听端口，必须是 443，这是穿透校园网的关键  </span><br><span class="hljs-attr">bindPort</span> = <span class="hljs-number">443</span>  <br>  <br><span class="hljs-comment"># 授权令牌，相当于密码，客户端也要填一样的  </span><br><span class="hljs-attr">auth.token</span> = <span class="hljs-string">&quot;OpenGMS123456&quot;</span>  <br><span class="hljs-attr">transport.tls.force</span> = <span class="hljs-literal">true</span>   <span class="hljs-comment"># 关键！强制 TLS，防止防火墙 DPI 检测</span><br>  <br><span class="hljs-comment"># (可选)如果你想看 FRP 的仪表盘，配置下面这几行  </span><br><span class="hljs-attr">webServer.addr</span> = <span class="hljs-string">&quot;0.0.0.0&quot;</span>  <br><span class="hljs-attr">webServer.port</span> = <span class="hljs-number">7500</span>  <br><span class="hljs-attr">webServer.user</span> = <span class="hljs-string">&quot;admin&quot;</span>  <br><span class="hljs-attr">webServer.password</span> = <span class="hljs-string">&quot;admin&quot;</span><br></code></pre></td></tr></table></figure><h3 id="2-K8S-客户端配置-frpc"><a href="#2-K8S-客户端配置-frpc" class="headerlink" title="2. K8S 客户端配置 (frpc)"></a>2. K8S 客户端配置 (frpc)</h3><p>在 K8S 中，我通过 ConfigMap 挂载配置，注意 TOML 格式的坑，<strong>全局配置必须写在 <code>[[proxies]]</code> 上面</strong>。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># frpc.toml (ConfigMap)</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>  <br><span class="hljs-attr">kind:</span> <span class="hljs-string">ConfigMap</span>  <br><span class="hljs-attr">metadata:</span>  <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">frpc-config</span>  <br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">satellite-micro</span>  <span class="hljs-comment"># 建议把 FRP 放在和服务同一个命名空间，方便管理  </span><br><span class="hljs-attr">data:</span>  <br>  <span class="hljs-attr">frpc.toml:</span> <span class="hljs-string">|  </span><br><span class="hljs-string">    # ==============================  </span><br><span class="hljs-string">    # 连接 VPS 的配置  </span><br><span class="hljs-string">    # ==============================  </span><br><span class="hljs-string">    serverAddr = &quot;114.55.142.175&quot;      # 【修改这里】你的 VPS 公网 IP  </span><br><span class="hljs-string">    serverPort = 443            # 必须对应 frps.toml 里的 bindPort (443)  </span><br><span class="hljs-string">    auth.token = &quot;OpenGMS123456&quot;  # 【修改这里】必须和 frps.toml 里的 token 一致  </span><br><span class="hljs-string">    transport.tls.enable = true  </span><br><span class="hljs-string">    # ==============================  </span><br><span class="hljs-string">    # 穿透规则：卫星前端服务  </span><br><span class="hljs-string">    # ==============================  </span><br><span class="hljs-string">    [[proxies]]  </span><br><span class="hljs-string">    name = &quot;satellite-frontend&quot;  </span><br><span class="hljs-string">    type = &quot;tcp&quot;  </span><br><span class="hljs-string">      </span><br><span class="hljs-string">    # K8S 内部 DNS 地址 (服务名.命名空间.svc)  </span><br><span class="hljs-string">    localIP = &quot;satellite-front-v2.satellite-micro.svc&quot;  </span><br><span class="hljs-string">      </span><br><span class="hljs-string">    # 你的 Service 端口  </span><br><span class="hljs-string">    localPort = 5173  </span><br><span class="hljs-string">      </span><br><span class="hljs-string">    # 【关键】外网 VPS 监听端口  </span><br><span class="hljs-string">    remotePort = 5173   </span><br><span class="hljs-string"></span>  <br><span class="hljs-meta">---  </span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>  <br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>  <br><span class="hljs-attr">metadata:</span>  <br>  <span class="hljs-attr">name:</span> <span class="hljs-string">frpc-satellite</span>  <br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">satellite-micro</span>  <span class="hljs-comment"># 部署在同一个命名空间  </span><br>  <span class="hljs-attr">labels:</span>  <br>    <span class="hljs-attr">app:</span> <span class="hljs-string">frpc-satellite</span>  <br><span class="hljs-attr">spec:</span>  <br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>  <br>  <span class="hljs-attr">selector:</span>  <br>    <span class="hljs-attr">matchLabels:</span>  <br>      <span class="hljs-attr">app:</span> <span class="hljs-string">frpc-satellite</span>  <br>  <span class="hljs-attr">template:</span>  <br>    <span class="hljs-attr">metadata:</span>  <br>      <span class="hljs-attr">labels:</span>  <br>        <span class="hljs-attr">app:</span> <span class="hljs-string">frpc-satellite</span>  <br>    <span class="hljs-attr">spec:</span>  <br>      <span class="hljs-attr">containers:</span>  <br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">frpc</span>  <br>        <span class="hljs-attr">image:</span> <span class="hljs-number">223.2</span><span class="hljs-number">.44</span><span class="hljs-number">.251</span><span class="hljs-string">/satellite/frpc:latest</span>  <br>        <span class="hljs-attr">resources:</span>  <br>          <span class="hljs-attr">limits:</span>  <br>            <span class="hljs-attr">cpu:</span> <span class="hljs-string">200m</span>  <br>            <span class="hljs-attr">memory:</span> <span class="hljs-string">128Mi</span>  <br>        <span class="hljs-attr">volumeMounts:</span>  <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config</span>  <br>          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/etc/frp/frpc.toml</span>  <br>          <span class="hljs-attr">subPath:</span> <span class="hljs-string">frpc.toml</span>  <br>      <span class="hljs-attr">volumes:</span>  <br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">config</span>  <br>        <span class="hljs-attr">configMap:</span>  <br>          <span class="hljs-attr">name:</span> <span class="hljs-string">frpc-config</span><br></code></pre></td></tr></table></figure><h3 id="3-一个小插曲：神奇的-i-o-timeout"><a href="#3-一个小插曲：神奇的-i-o-timeout" class="headerlink" title="3. 一个小插曲：神奇的 i&#x2F;o timeout"></a>3. 一个小插曲：神奇的 i&#x2F;o timeout</h3><p>配置好后，日志一度报 <code>i/o timeout</code>。查了半天防火墙和安全组，最后发现竟然是因为<strong>K8S 宿主机的校园网登录认证过期了</strong>……</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -k -c /tmp/school_cookies.txt -b /tmp/school_cookies.txt   <span class="hljs-string">&quot;http://172.28.255.156:801/eportal/portal/login?callback=dr1003&amp;login_method=1&amp;user_account=%2C0%2C学号&amp;user_password=密码&quot;</span>   -v -L -D /tmp/login_headers.txt -o /tmp/login_body.txt<br></code></pre></td></tr></table></figure><p>在宿主机上写个脚本 <code>curl</code> 模拟登录后，FRP 瞬间显示 <code>start proxy success</code>。此时，我已经可以通过 <code>http://114.55.142.175:5173</code> 访问到前端页面了。</p><hr><h2 id="第三阶段：解决-403-Forbidden-——-后端代码与-Nginx-的博弈"><a href="#第三阶段：解决-403-Forbidden-——-后端代码与-Nginx-的博弈" class="headerlink" title="第三阶段：解决 403 Forbidden —— 后端代码与 Nginx 的博弈"></a>第三阶段：解决 403 Forbidden —— 后端代码与 Nginx 的博弈</h2><p>原本以为网络通了就万事大吉，结果登录时前端报错：</p><blockquote><p><strong>Status Code: 403 Forbidden</strong> <strong>Request URL:</strong> <code>http://114.55.142.175:5173/api/user/login</code></p></blockquote><p>奇怪的是，如果我用内网 IP (<code>223.2.x.x</code>) 访问，一切正常。</p><h3 id="1-原理分析：Spring-Boot-的-CORS-校验"><a href="#1-原理分析：Spring-Boot-的-CORS-校验" class="headerlink" title="1. 原理分析：Spring Boot 的 CORS 校验"></a>1. 原理分析：Spring Boot 的 CORS 校验</h3><p>看了后端 Java 代码才恍然大悟。后端配置了 Spring Security 的 CORS 策略：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 后端代码片段</span><br>registry.addMapping(<span class="hljs-string">&quot;/**&quot;</span>)<br>    .allowedOriginPatterns(<br>        <span class="hljs-string">&quot;http://localhost:*&quot;</span>, <br>        <span class="hljs-string">&quot;http://223.*&quot;</span>,   <span class="hljs-comment">// 👈 信任校园网/内网 IP</span><br>        <span class="hljs-string">&quot;http://192.*&quot;</span><br>        <span class="hljs-comment">// 😱 唯独没有信任我的 VPS IP (114.*)</span><br>    );<br></code></pre></td></tr></table></figure><p><strong>案情还原：</strong></p><ol><li><p>当我通过 FRP 访问时，浏览器发出的 HTTP 请求头中，<code>Origin</code> 是 <code>http://114.55.142.175:5173</code>。</p></li><li><p>Nginx 默认透传了这个 Header 给后端。</p></li><li><p>后端保安一看：“<code>114</code> 开头的？不在白名单里，拒绝！”</p></li></ol><h3 id="2-解决方案：Nginx-“偷渡”法"><a href="#2-解决方案：Nginx-“偷渡”法" class="headerlink" title="2. 解决方案：Nginx “偷渡”法"></a>2. 解决方案：Nginx “偷渡”法</h3><p>为了解决这个问题，我有两个选择：要么改 Java 代码重新打包镜像（太慢），要么改前端 Nginx 配置（快）。</p><p>我选择了后者。利用 Nginx 修改请求头，<strong>把 Origin 抹除</strong>，让后端误以为这是一个“同源请求”或“非跨域请求”。</p><p>修改前端 Nginx 的 <code>location /api/</code> 配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /api/ &#123;<br>    <span class="hljs-attribute">proxy_pass</span> http://20.1.59.49:8999/api/v1/;<br>    <br>    <span class="hljs-comment"># 👇 关键修改：把身份证撕了</span><br>    <span class="hljs-attribute">proxy_set_header</span> Origin <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> Referer <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-结果"><a href="#3-结果" class="headerlink" title="3. 结果"></a>3. 结果</h3><p>配置生效后，Nginx 在转发请求前去掉了 <code>Origin</code> 头。Spring Boot 收到请求后，发现没有 Origin 信息，默认跳过了 CORS 检查机制。</p><p>刷新浏览器，登录成功，接口返回 200 OK！</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这次折腾让我深刻理解了网络链路的每一环：</p><ol><li><p><strong>物理层&#x2F;防火墙层：</strong> 校园网环境下，标准端口（443）+ TLS 加密是穿透防火墙的最稳方案，UDP 和非标端口基本没戏。</p></li><li><p><strong>网络层：</strong> FRP 在 K8S 里配合 ConfigMap 使用非常灵活，但要注意宿主机的网络连通性（别忘了登录校园网账号！）。</p></li><li><p><strong>应用层：</strong> 网络通了不代表应用能用。<strong>同源策略</strong>和<strong>后端白名单</strong>是跨域访问的两大拦路虎。通过 Nginx 清洗 Header 是一种非常实用的运维级规避手段。</p></li></ol><p>希望这篇踩坑记录能帮到同样在校园网里挣扎的 K8S 玩家们。</p>]]></content>
    
    
    <categories>
      
      <category>工具与效率</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>内网穿透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>为什么我的外网IP(223.x)能和WiFi内网IP(10.x)相互通信？——校园网路由解密</title>
    <link href="/2025/12/03/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84%E5%A4%96%E7%BD%91IP-223-x-%E8%83%BD%E5%92%8CWiFi%E5%86%85%E7%BD%91IP-10-x-%E7%9B%B8%E4%BA%92%E9%80%9A%E4%BF%A1%EF%BC%9F%E2%80%94%E2%80%94%E6%A0%A1%E5%9B%AD%E7%BD%91%E8%B7%AF%E7%94%B1%E8%A7%A3%E5%AF%86/"/>
    <url>/2025/12/03/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84%E5%A4%96%E7%BD%91IP-223-x-%E8%83%BD%E5%92%8CWiFi%E5%86%85%E7%BD%91IP-10-x-%E7%9B%B8%E4%BA%92%E9%80%9A%E4%BF%A1%EF%BC%9F%E2%80%94%E2%80%94%E6%A0%A1%E5%9B%AD%E7%BD%91%E8%B7%AF%E7%94%B1%E8%A7%A3%E5%AF%86/</url>
    
    <content type="html"><![CDATA[<h1 id="🤯-深入校园网：为什么我的公网-IP-223-能访问内网-IP-10-？"><a href="#🤯-深入校园网：为什么我的公网-IP-223-能访问内网-IP-10-？" class="headerlink" title="🤯 深入校园网：为什么我的公网 IP (223) 能访问内网 IP (10)？"></a>🤯 深入校园网：为什么我的公网 IP (223) 能访问内网 IP (10)？</h1><p>不知道大家有没有在校园网里遇到过一个“怪现象”：你的电脑明明分配到了一个看起来像外网的 IP 地址（比如 <code>223.2.34.174</code>），却能轻而易举地访问到学校 WiFi 下的内网设备（比如 <code>10.30.88.110</code>）？</p><p>按照常理，公网和内网之间应该有一道“天堑”才对！今天，我们就来解开这个谜团，一文搞懂校园网的幕后英雄——<strong>路由域（Routing Domain）</strong>。</p><hr><h2 id="🌐-第一步：识别玩家-—-它们是不同的“网段”"><a href="#🌐-第一步：识别玩家-—-它们是不同的“网段”" class="headerlink" title="🌐 第一步：识别玩家 — 它们是不同的“网段”"></a>🌐 第一步：识别玩家 — 它们是不同的“网段”</h2><p>首先，我们需要明确一点：你的电脑和 WiFi 设备，从网络结构上看，它们属于两个完全不同的<strong>网段（Subnets）</strong>。</p><ol><li><p><strong>有线网段（223.x.x.x）：</strong> 这是一个独特的 IP 地址池，在校园网内，它代表着你的有线连接或实验室设备。这里实际连接着的是我的笔记本电脑（有线接口）。</p></li><li><p><strong>无线网段（10.x.x.x）：</strong> 这是一个标准的私有 IP 地址池，你的 WiFi 手机就连接在这个网段。这里实际连接着的是我的另一台笔记本（无线网卡）。</p></li></ol><p><strong>核心问题：</strong> 不同的网段天然是隔离的，就像住在不同城市的人，如果没有一个交通系统，他们无法直接互相发送消息。</p><hr><h2 id="🗺️-第二步：核心前提-—-人工配置“路由域”（The-Big-Club）"><a href="#🗺️-第二步：核心前提-—-人工配置“路由域”（The-Big-Club）" class="headerlink" title="🗺️ 第二步：核心前提 — 人工配置“路由域”（The Big Club）"></a>🗺️ 第二步：核心前提 — 人工配置“路由域”（The Big Club）</h2><p>为了让这两个隔离的“城市”能够互相通信，管理员需要进行最关键的一步：<strong>将它们纳入同一个“俱乐部”——路由域。</strong></p><h3 id="什么是路由域？"><a href="#什么是路由域？" class="headerlink" title="什么是路由域？"></a>什么是路由域？</h3><p>你可以把<strong>路由域</strong>想象成<strong>整个校园网的管辖范围</strong>。在这个域内，所有路由器（调度中心）都同意使用同一张地图和一套规则来查找路径。</p><p><strong>这是人为配置的！</strong> 管理员在学校的核心路由器上，手动配置了以下内容：</p><ul><li><p><strong>身份定义：</strong> “我宣布！<code>223.x</code> 地址池和 <code>10.x</code> 地址池，虽然 IP 地址看起来不同，但它们都属于我们学校的内部网络。”</p></li><li><p><strong>路由开启：</strong> 开启了动态路由协议（例如 OSPF）。这相当于给所有路由器安装了一个<strong>实时更新的 GPS 系统</strong>。</p></li></ul><p><strong>关键点：</strong> 一旦将 <code>223.x</code> 和 <code>10.x</code> 都配置在同一个路由域内，中央路由器就知道：“这两块地都是我的，流量不用扔到校外去。”</p><hr><h2 id="🚀-第三步：核心机制-—-路由器与互通"><a href="#🚀-第三步：核心机制-—-路由器与互通" class="headerlink" title="🚀 第三步：核心机制 — 路由器与互通"></a>🚀 第三步：核心机制 — 路由器与互通</h2><p>有了路由域这个“俱乐部”基础，<strong>路由器</strong>就可以开始工作了。</p><h3 id="为什么能互相发送消息？"><a href="#为什么能互相发送消息？" class="headerlink" title="为什么能互相发送消息？"></a>为什么能互相发送消息？</h3><p>不同网段能互通，是因为**路由器充当了“中央邮局”**的角色：</p><ol><li><p><strong>发起请求：</strong> 你的电脑（223.x）想访问 WiFi 上的服务器（10.x）。它发现目标 IP 不在自己的网段内，于是把数据包扔给了自己的网关（路由器）。</p></li><li><p><strong>查阅地图：</strong> 中央路由器拿到数据包后，查询它的<strong>路由表（Routing Table）</strong>。</p></li><li><p><strong>精确投递：</strong> 路由器发现地图上清清楚楚地写着：“去 <code>10.x.x.x</code> 的最佳路径，就在 4 号接口。” 它立刻将数据包转发到 4 号接口，消息顺利到达了 WiFi 设备。</p></li></ol><p>在这个过程中，<strong>动态路由协议</strong>的作用只是<strong>实时更新</strong>这张地图，确保所有路由器的路径信息都是最新的和最优的。</p><h3 id="📰-安全策略补充：流量的去向与拦截点"><a href="#📰-安全策略补充：流量的去向与拦截点" class="headerlink" title="📰 安全策略补充：流量的去向与拦截点"></a>📰 安全策略补充：流量的去向与拦截点</h3><p>前面我们已经知道，路由器是让 <code>223.x</code> 和 <code>10.x</code> 互通的关键，但如果目标地址不存在，或者流量来自外部，数据包的命运又会如何呢？</p><h4 id="1-为什么校内互通流量默认不会被拦截？"><a href="#1-为什么校内互通流量默认不会被拦截？" class="headerlink" title="1. 为什么校内互通流量默认不会被拦截？"></a>1. 为什么校内互通流量默认不会被拦截？</h4><p><strong>核心原因：信任与行政规划。</strong></p><p>我们的 <code>223.x</code> 和 <code>10.x</code> 都被管理员配置在了<strong>同一个路由域</strong>内。在默认配置下，路由域内的所有成员都是<strong>互相信任的</strong>。</p><ul><li><p><strong>策略设置：</strong> 除非管理员在路由器上配置了明确的 <strong>ACL（拒绝策略）</strong>，例如“禁止学生访问教务系统”，否则路由器会直接根据路由表转发流量。</p></li><li><p><strong>默认放行：</strong> 只要流量的目的地在路由域的地图上（例如，目标是 <code>10.x</code>），且没有被 ACL 明确禁止，中央路由器就会放行。</p></li></ul><h4 id="2-如果消息发给一个“不存在的”内网-IP？（内部丢弃）"><a href="#2-如果消息发给一个“不存在的”内网-IP？（内部丢弃）" class="headerlink" title="2. 如果消息发给一个“不存在的”内网 IP？（内部丢弃）"></a>2. 如果消息发给一个“不存在的”内网 IP？（内部丢弃）</h4><p>假设你从 <code>223.x</code> 发送消息给 <code>10.30.88.99</code>，但这个设备根本不存在。</p><ul><li><p><strong>谁来丢弃？</strong> 负责 <code>10.30.88.x</code> 网段的<strong>最终网关路由器&#x2F;三层交换机</strong>。</p></li><li><p><strong>丢弃过程：</strong></p><ol><li><p>消息会成功通过所有核心路由器，到达负责 <code>10.30.88.x</code> 这个子网的<strong>门口</strong>（最终网关）。</p></li><li><p>这个网关尝试用 <strong>ARP 协议</strong>（大声喊话）来找到 <code>10.30.88.99</code> 的 MAC 地址。</p></li><li><p>由于设备不存在，喊话无人应答。</p></li><li><p>网关尝试几次后，发现目标无法解析，它会<strong>丢弃数据包</strong>，并通常会给你的电脑返回一个 <strong>“目标主机不可达”</strong> 的错误消息。</p></li></ol></li></ul><h4 id="3-外网为什么会被拦截？（外部丢弃）"><a href="#3-外网为什么会被拦截？（外部丢弃）" class="headerlink" title="3. 外网为什么会被拦截？（外部丢弃）"></a>3. 外网为什么会被拦截？（外部丢弃）</h4><p>如果你从家里的宽带网络发消息给校内的 <code>10.x.x.x</code>，它会被双重拦截，<strong>以保障校内安全</strong>：</p><table><thead><tr><th>丢弃点</th><th>谁在丢弃？</th><th>丢弃依据</th><th>目的</th></tr></thead><tbody><tr><td><strong>第一站</strong></td><td><strong>互联网服务提供商 (ISP) 骨干网路由器</strong></td><td><strong>地址非法 (RFC 1918)</strong>：这些路由器配置了过滤规则，禁止私有 IP 地址出现在公网上。</td><td>维护全球互联网的秩序，防止地址混乱。</td></tr><tr><td><strong>第二站</strong></td><td><strong>校园网边界防火墙</strong></td><td><strong>安全策略</strong>：防火墙默认拒绝所有来自外部、主动请求连接内部私有 IP 的流量。</td><td>保护校内资源，防止未经授权的入侵。</td></tr></tbody></table><h3 id="最终总结"><a href="#最终总结" class="headerlink" title="最终总结"></a>最终总结</h3><p>你之所以能在 <code>223</code> 网段访问到 <code>10</code> 网段，并不是因为 IP 地址神奇地跨越了公网和私网的界限，而是因为：</p><ol><li><p><strong>管理员人为设定了</strong>：<code>223.x</code> 和 <code>10.x</code> 属于<strong>同一个路由域</strong>。</p></li><li><p><strong>路由器工作了</strong>：路由器根据这张内部地图，完美地完成了 <strong>不同网段之间的 L3 转发</strong>，将流量始终保留在校园网这个巨大的局域网内部。</p></li><li></li></ol><p>下次当你顺利访问到 WiFi 设备时，记得给幕后那些辛勤配置的网管点个赞！👍</p>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>八股文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>操作系统第一章：《操作系统概述》</title>
    <link href="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/"/>
    <url>/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="本章导览"><a href="#本章导览" class="headerlink" title="本章导览"></a>本章导览</h1><ul><li>操作系统运行机制、体系结构</li><li>系统调用的过程</li><li>开机过程、虚拟机</li></ul><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251128161458.png" class="" title="Pasted image 20251128161458.png"><p>联机&#x2F;脱机</p><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251128163511.png" class="" title="Pasted image 20251128163511.png"><p>并发与共享互为前提</p><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251128165654.png" class="" title="Pasted image 20251128165654.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251128171751.png" class="" title="Pasted image 20251128171751.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251128171827.png" class="" title="Pasted image 20251128171827.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201094615.png" class="" title="Pasted image 20251201094615.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201094626.png" class="" title="Pasted image 20251201094626.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201095015.png" class="" title="Pasted image 20251201095015.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201095032.png" class="" title="Pasted image 20251201095032.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201095147.png" class="" title="Pasted image 20251201095147.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201095108.png" class="" title="Pasted image 20251201095108.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201095305.png" class="" title="Pasted image 20251201095305.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201095602.png" class="" title="Pasted image 20251201095602.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201101149.png" class="" title="Pasted image 20251201101149.png"><img src="/2025/12/02/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E3%80%8B/Pasted%20image%2020251201101157.png" class="" title="Pasted image 20251201101157.png">]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>八股文</tag>
      
      <tag>操作系统</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>计网第六章：《应用层》</title>
    <link href="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/"/>
    <url>/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127142147.png" class="" title="Pasted image 20251127142147.png"><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127145834.png" class="" title="Pasted image 20251127145834.png"><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127145817.png" class="" title="Pasted image 20251127145817.png"><p>DNS协议，顶级域名、二级域名、三级域名等<br>本地域名服务器、顶级域名服务器、二级域名服务器、权限域名服务器等<br>递归查询、迭代查询</p><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127160215.png" class="" title="Pasted image 20251127160215.png"><p>smb和nfs分别是面向windows和unix的网络文件系统？而ftp、sftp是协议，主要上传下载</p><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127163355.png" class="" title="Pasted image 20251127163355.png"><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127163416.png" class="" title="Pasted image 20251127163416.png"><p>SMTP&#x2F;POP3</p><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127200518.png" class="" title="Pasted image 20251127200518.png"><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127200701.png" class="" title="Pasted image 20251127200701.png"><p>注意传播时延与传输时延（小文件忽略）；注意非持续连接在挥手时即可开始下一次请求响应，或并行执行。</p><img src="/2025/11/28/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E3%80%8A%E5%BA%94%E7%94%A8%E5%B1%82%E3%80%8B/Pasted%20image%2020251127203607.png" class="" title="Pasted image 20251127203607.png"><p>抓包？keep-alive和close分别表示持续连接和非持续连接<br>web服务器默认80端口</p><blockquote><p>请注意：本笔记内容中的截图资源来自王道考研机构，侵删。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>八股文</tag>
      
      <tag>DNS协议</tag>
      
      <tag>FTP协议</tag>
      
      <tag>HTTP协议</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>计网第五章：《传输层》</title>
    <link href="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/"/>
    <url>/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="本章导览"><a href="#本章导览" class="headerlink" title="本章导览"></a>本章导览</h1><ul><li>UDP与TCP报文组成</li><li>TCP三次握手、四次挥手过程，MSS，耗时分析，MSL, ACK&#x2F;SYN&#x2F;FIN变化</li><li>累积&#x2F;推迟确认、捎带确认、超时重传、快重传机制</li><li>流量控制与拥塞控制，有点拥塞与严重拥塞</li><li>关注：可否携带数据、各个字段的值、耗时分析、是否消耗序号？</li></ul><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125155720.png" class="" title="Pasted image 20251125155720.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125170137.png" class="" title="Pasted image 20251125170137.png"><p>UDP数据报实际长度不超过65515B</p><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125170159.png" class="" title="Pasted image 20251125170159.png"><p>UDP检验跳过</p><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125193048.png" class="" title="Pasted image 20251125193048.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125193105.png" class="" title="Pasted image 20251125193105.png"><p>TCP报文段组成：<img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125203750.png" class="" title="Pasted image 20251125203750.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125203839.png" class="" title="Pasted image 20251125203839.png"></p><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125203628.png" class="" title="Pasted image 20251125203628.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125203913.png" class="" title="Pasted image 20251125203913.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125203944.png" class="" title="Pasted image 20251125203944.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125204113.png" class="" title="Pasted image 20251125204113.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125204237.png" class="" title="Pasted image 20251125204237.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125204218.png" class="" title="Pasted image 20251125204218.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125204312.png" class="" title="Pasted image 20251125204312.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125204333.png" class="" title="Pasted image 20251125204333.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125223726.png" class="" title="Pasted image 20251125223726.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125223750.png" class="" title="Pasted image 20251125223750.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251125223717.png" class="" title="Pasted image 20251125223717.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251126223252.png" class="" title="Pasted image 20251126223252.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251126223232.png" class="" title="Pasted image 20251126223232.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251126223149.png" class="" title="Pasted image 20251126223149.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251126223200.png" class="" title="Pasted image 20251126223200.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251126223128.png" class="" title="Pasted image 20251126223128.png"><p>可靠传输与流量控制<img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251126230049.png" class="" title="Pasted image 20251126230049.png"></p><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251126225746.png" class="" title="Pasted image 20251126225746.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127101442.png" class="" title="Pasted image 20251127101442.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127101516.png" class="" title="Pasted image 20251127101516.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127101539.png" class="" title="Pasted image 20251127101539.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127101340.png" class="" title="Pasted image 20251127101340.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127105937.png" class="" title="Pasted image 20251127105937.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127105353.png" class="" title="Pasted image 20251127105353.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130413.png" class="" title="Pasted image 20251127130413.png">注意区别严重拥塞和有点拥塞<img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130357.png" class="" title="Pasted image 20251127130357.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130629.png" class="" title="Pasted image 20251127130629.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130724.png" class="" title="Pasted image 20251127130724.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130752.png" class="" title="Pasted image 20251127130752.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130828.png" class="" title="Pasted image 20251127130828.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130851.png" class="" title="Pasted image 20251127130851.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127130901.png" class="" title="Pasted image 20251127130901.png"><img src="/2025/11/26/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%94%E7%AB%A0%EF%BC%9A%E3%80%8A%E4%BC%A0%E8%BE%93%E5%B1%82%E3%80%8B/Pasted%20image%2020251127141722.png" class="" title="Pasted image 20251127141722.png">快重传引发快恢复<blockquote><p>请注意：本笔记内容中的截图资源来自王道考研机构，侵删。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>八股文</tag>
      
      <tag>TCP协议</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>计网第四章：《网络层》</title>
    <link href="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/"/>
    <url>/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="本章导览"><a href="#本章导览" class="headerlink" title="本章导览"></a>本章导览</h1><ul><li>IP数据报组成</li><li>传统IP地址分类、子网划分技术（定长&#x2F;变长）、CIDR、路由聚合、NAT转换、IP数据报流转过程分析</li><li>ARP、DHCP、ICMP</li><li>IPv6、路由算法、自治系统</li></ul><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124105357.png" class="" title="Pasted image 20251124105357.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124210422.png" class="" title="Pasted image 20251124210422.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124124916.png" class="" title="Pasted image 20251124124916.png">MTU 限制的是 IP 数据报的大小（不含链路层头部）<img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124125202.png" class="" title="Pasted image 20251124125202.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124143503.png" class="" title="Pasted image 20251124143503.png">路由器与路由器之间如果使用的是“二层透明传输”方式（如 PPP、HDLC、Frame Relay、MPLS、隧道等），链路本身不需要跑 IP，因此接口不需要分配 IP。  <p>但路由器与普通节点（主机、服务器）之间需要让主机找到“网关”，必须分配 IP。</p><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124143432.png" class="" title="Pasted image 20251124143432.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124143443.png" class="" title="Pasted image 20251124143443.png"><p>思考几个过程：H1到H8（不在一个网络，先给默认网关，通过ARP封装成MAC帧，逐层转发）<br>H1到H6呢？</p><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124153101.png" class="" title="Pasted image 20251124153101.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124153131.png" class="" title="Pasted image 20251124153131.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124153211.png" class="" title="Pasted image 20251124153211.png">传统网络采用对应类别的默认子网掩码<img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124153234.png" class="" title="Pasted image 20251124153234.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124153246.png" class="" title="Pasted image 20251124153246.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124163924.png" class="" title="Pasted image 20251124163924.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124163952.png" class="" title="Pasted image 20251124163952.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124164003.png" class="" title="Pasted image 20251124164003.png"><p>路由聚合<img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124192805.png" class="" title="Pasted image 20251124192805.png"></p><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124192818.png" class="" title="Pasted image 20251124192818.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124192739.png" class="" title="Pasted image 20251124192739.png"><p>练习：H1给铁柱1（路由聚合，F1、2、3到G1的转变）<br>NAT：</p><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124202218.png" class="" title="Pasted image 20251124202218.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124202624.png" class="" title="Pasted image 20251124202624.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124203245.png" class="" title="Pasted image 20251124203245.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124225555.png" class="" title="Pasted image 20251124225555.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124225526.png" class="" title="Pasted image 20251124225526.png"><p>DHCP（应用层，基于UDP，基于C-S）：</p><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124222059.png" class="" title="Pasted image 20251124222059.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251124222128.png" class="" title="Pasted image 20251124222128.png"><p>ICMP</p><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251125104936.png" class="" title="Pasted image 20251125104936.png"><p>traceroute -I <a href="http://www.baidu.com/">www.baidu.com</a> 基于ICMP，每次设置TTL</p><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251125131200.png" class="" title="Pasted image 20251125131200.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251125151431.png" class="" title="Pasted image 20251125151431.png"><img src="/2025/11/22/%E8%AE%A1%E7%BD%91%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%BD%91%E7%BB%9C%E5%B1%82%E3%80%8B/Pasted%20image%2020251125152546.png" class="" title="Pasted image 20251125152546.png"><p>具体协议内容此处省略</p><blockquote><p>请注意：本笔记内容中的截图资源来自王道考研机构，侵删。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>八股文</tag>
      
      <tag>IP协议</tag>
      
      <tag>CIDR</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>计网第三章：《数据链路层》</title>
    <link href="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/"/>
    <url>/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="本章导览"><a href="#本章导览" class="headerlink" title="本章导览"></a>本章导览</h1><ul><li>组帧、差错控制、可靠传输与流量控制、介质访问控制</li><li>局域网发展与组成、令牌环网、以太网、VLAN、WLAN</li><li>以太网V2帧、802.1Q帧、802.11帧</li><li>交换机原理</li></ul><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251119111013.png" class="" title="Pasted image 20251119111013.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251118193242.png" class="" title="Pasted image 20251118193242.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251118195020.png" class="" title="Pasted image 20251118195020.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251118211106.png" class="" title="Pasted image 20251118211106.png"> <img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251119110715.png" class="" title="Pasted image 20251119110715.png"> <img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251119111654.png" class="" title="Pasted image 20251119111654.png"> <img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251119142218.png" class="" title="Pasted image 20251119142218.png"><p> 停止等待协议，接收窗口控制流量的方式：只有接收方发送确认帧后才向后滑动，发送方收到确认帧，向后滑动。<br> <strong>帧丢失</strong>：发送方有计时器，超时重发；<strong>帧错误</strong>类似；<br> <strong>重复帧</strong>：（确认帧丢失），此时接收方窗口来到下一个，发送方重发，接收方收到非法帧，会选择丢弃，然后再发一个确认帧。这里体现出了<code>帧编号</code>的作用。<br> 因为窗口&#x3D;1，所以不存在帧失序问题。<br> <img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251119145640.png" class="" title="Pasted image 20251119145640.png"><br> GBN协议：信道没有连续的数据时，视为所有帧<br> 帧丢失：返回ACK，让发送方知道，再重传最后一个正确的之后所有<br> 帧错误：丢弃这一帧，返回最后一个正确的ACK，重传后面的（与SW稍有不同）<br> 帧重复：（确认帧丢失），返回最后一个正确的ACK，重传后面的<br> <img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251119152652.png" class="" title="Pasted image 20251119152652.png"><br> SR协议：窗口滑动：接收方发送确认帧后即滑动 &#x2F; 发送方收到确认帧后即滑动；每一帧都有ACK确认；必须Wt&gt;&#x3D;Wr<br> 帧丢失：超时重传机制<br> 帧错误：请求重传机制（否认帧NAK）<br> 帧重复：确认帧丢失，与GBN类似</p><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251119161556.png" class="" title="Pasted image 20251119161556.png"><p>信道利用率：有效数据的传输，传播时延不应算在分子上</p><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120102430.png" class="" title="Pasted image 20251120102430.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120105957.png" class="" title="Pasted image 20251120105957.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120150750.png" class="" title="Pasted image 20251120150750.png"><p>CSMA&#x2F;CD协议的接收方流程：先判断最短帧长，非法帧直接丢弃；再判断是不是自己的，不是即丢弃；再根据可靠传输协议，判断帧；最后上报网络层</p><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120155538.png" class="" title="Pasted image 20251120155538.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120155551.png" class="" title="Pasted image 20251120155551.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120155612.png" class="" title="Pasted image 20251120155612.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120162813.png" class="" title="Pasted image 20251120162813.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251120185421.png" class="" title="Pasted image 20251120185421.png"><p>集线器？中继器（两个端口，放大衰减信号，延长冲突域距离）？<br>全双工通信？半双工通信？</p><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251122162537.png" class="" title="Pasted image 20251122162537.png"><p>交换机检验MAC地址，所以隔离了冲突域，但对两个半双工通信的冲突域而言，隔离的只是两个集线器之间的冲突。路由器隔离广播域；<br>交换机工作在物理层和数据链路层、集线器工作在物理层、路由器工作在物理层数据链路层和网络层<br>双绞线2.5Gbps以上只支持全双工通信<br>收发协数验（目的MAC地址、源MAC地址、网络层协议、数据、CRC码）</p><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251122171336.png" class="" title="Pasted image 20251122171336.png"><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251122221407.png" class="" title="Pasted image 20251122221407.png"><p>802.11帧组成部分：<br>首部+数据+校验码<br>首部由类别、子类别、去AP&#x2F;来AP、地址1&#x2F;2&#x2F;3等组成，地址1&#x2F;2分别为要去的、来自的MAC地址</p><img src="/2025/11/18/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%89%E7%AB%A0%EF%BC%9A%E3%80%8A%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E3%80%8B/Pasted%20image%2020251124101024.png" class="" title="Pasted image 20251124101024.png"><blockquote><p>请注意：本笔记内容中的截图资源来自王道考研机构，侵删。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>八股文</tag>
      
      <tag>以太网</tag>
      
      <tag>WLAN</tag>
      
      <tag>交换机</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>计网第二章：《物理层》</title>
    <link href="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/"/>
    <url>/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/</url>
    
    <content type="html"><![CDATA[ <img src="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/Pasted%20image%2020251115154108.png" class="" title="Pasted image 20251115154108.png"> <img src="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/Pasted%20image%2020251115154533.png" class="" title="Pasted image 20251115154533.png"><img src="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/Pasted%20image%2020251115161611.png" class="" title="Pasted image 20251115161611.png"><p> 有线：数字信号（编码&#x2F;解码）；光猫&#x2F;真空：模拟信号（调制&#x2F;解调）<br> <img src="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/Pasted%20image%2020251115174246.png" class="" title="Pasted image 20251115174246.png"></p><img src="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/Pasted%20image%2020251115174725.png" class="" title="Pasted image 20251115174725.png"><img src="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/Pasted%20image%2020251115184214.png" class="" title="Pasted image 20251115184214.png"><img src="/2025/11/12/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E3%80%8A%E7%89%A9%E7%90%86%E5%B1%82%E3%80%8B/Pasted%20image%2020251115190826.png" class="" title="Pasted image 20251115190826.png"><p>网段：物理段、逻辑段（子网）<br>集线器不同网段（物理段），同一网段（逻辑段）</p><blockquote><p>请注意：本笔记内容中的截图资源来自王道考研机构，侵删。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>八股文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>计网第一章：《计算机网络体系结构》</title>
    <link href="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/"/>
    <url>/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/</url>
    
    <content type="html"><![CDATA[<img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251109172951.png" class="" title="Pasted image 20251109172951.png"><blockquote><p>⚠️注意区别：<br>集线器和交换机是将同一网络内的不同节点进行连接成一个计算机网络。（同一网段）<br>路由器连接的是不同网络，互连网。（不同网段）</p></blockquote><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251111202656.png" class="" title="Pasted image 20251111202656.png"><p>交换服务：走不同的网络链路</p><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251111202944.png" class="" title="Pasted image 20251111202944.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251111210808.png" class="" title="Pasted image 20251111210808.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251111210825.png" class="" title="Pasted image 20251111210825.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251111210837.png" class="" title="Pasted image 20251111210837.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251111215333.png" class="" title="Pasted image 20251111215333.png"><p>bit的传输是连续的</p><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251111221309.png" class="" title="Pasted image 20251111221309.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251112230352.png" class="" title="Pasted image 20251112230352.png"><p>存储：2的10次方，速率：1000<br>吞吐 &#x3D; 吞➕吐</p><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251114214910.png" class="" title="Pasted image 20251114214910.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251114223343.png" class="" title="Pasted image 20251114223343.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251114224212.png" class="" title="Pasted image 20251114224212.png"><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251114224134.png" class="" title="Pasted image 20251114224134.png"><p>实体、对等实体、协议（水平）、功能、接口、服务、PCI（首部、尾部）</p><p>OSI模型 ：</p><img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251115131225.png" class="" title="Pasted image 20251115131225.png"><p> TCP&#x2F;IP模型：<br> <img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251115133735.png" class="" title="Pasted image 20251115133735.png"><br> <img src="/2025/11/06/%E8%AE%A1%E7%BD%91%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E3%80%8B/Pasted%20image%2020251115134010.png" class="" title="Pasted image 20251115134010.png"><br> 网络层：无连接不可靠（数据报：无序，有检错（丢弃））、有连接可靠（虚电路：分组有序正确）<br> 传输层：无连接不可靠UDP协议，有连接可靠TCP协议</p><blockquote><p>请注意：本笔记内容中的截图资源来自王道考研机构，侵删。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>八股文</category>
      
    </categories>
    
    
    <tags>
      
      <tag>计算机网络</tag>
      
      <tag>八股文</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>重温前端三件套(一)：HTML</title>
    <link href="/2025/11/02/%E9%87%8D%E6%B8%A9%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97-%E4%B8%80-%EF%BC%9AHTML/"/>
    <url>/2025/11/02/%E9%87%8D%E6%B8%A9%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97-%E4%B8%80-%EF%BC%9AHTML/</url>
    
    <content type="html"><![CDATA[<p>HTML标签大小写不敏感，JS&#x2F;TS敏感<br>vue将MyComponent自动转为my-component<br>react自定义组件必须首字母大小写，某则会当作普通html标签处理</p><p>img的src相对路径与绝对路径之分，静态与打包模块化处理（assets）之分、原生html与vue、react区分</p><p>通用属性：<br>href 属性指定链接指向的页面的URL<br>src 属性指定要显示图像的路径<br>width 和 height 属性提供图像宽高信息<br>alt 属性为图像提供备用文本<br>style 属性用于向元素添加样式，例如颜色、字体、大小等<br>lang 属性声明网页的语言<br>title 属性定义了有关元素的一些额外信息</p><p title="hinttooltip"></p><hr> 元素被用来分隔 HTML 页面中的内容<pre> 元素定义预先格式化的文本<p>格式化元素旨在显示特殊类型的文本:</p><p><b> - 粗体文本<br><strong> - 重要文本<br><i> - 斜体文本<br><em> - 强调文本<br><mark> - 标记文本<br><small> - 较小的文本<br><del> - 删除的文本<br><ins> - 插入文本<br><sub> - 下标文本<br><sup> - 上标文本<br><abbr>定义缩写或首字母缩略语。</p><address>定义文档作者或拥有者的联系信息。<bdo>定义文本方向。<blockquote>定义从其他来源引用的节。<cite>定义著作的标题。<q>定义短的行内引用。<p>内联CSS<br>内部CSS</p><style>body {background-color: powderblue;}h1   {color: blue;}p    {color: red;}</style><p>外部CSS</p><head>  <link rel="stylesheet" href="styles.css"></head><p>margin和padding</p><p>top window<br> └─ iframe A<br>     └─ iframe B (当前页面)<br>target 值作用<br>_self在 iframe B 内打开<br>_parent在父级 iframe A 内打开<br>_top跳出所有 iframe，在最外层 top window 打开<br>_blank新开一个标签页，与 iframe 无关</p><p>对比总结<br>写法从哪里算起示例行为<br>xxx（不以 &#x2F; 开头）当前文件所在目录同级访问<br>.&#x2F;xxx当前目录（和上面等价）同级访问<br>..&#x2F;xxx上一级目录回退路径<br>&#x2F;xxx（以 &#x2F; 开头）网站根目录和页面文件位置无关<br>如果是在 Vue &#x2F; React 这种构建型项目中，会将网站根目录对应到 public，但那是构建工具行为，不是 HTML 本身的规则。</p><p>网站根目录的定义，nginx：root；服务器默认WebRoot配置</p><p><a><img src="" alt="备用文本"></a><br>href&#x3D;”mailto:<a href="mailto:&#115;&#x6f;&#109;&#x65;&#111;&#x6e;&#x65;&#x40;&#x65;&#x78;&#x61;&#x6d;&#112;&#108;&#x65;&#46;&#x63;&#111;&#x6d;">someone@example.com</a>“</p><p>HTML书签(本质上是跳转到某id属性的元素上)<br><a href="html_demo.html#C4">跳转到第 4 章</a></p><p>图像映射<br><img src="" alt="" usemap="#mymap"><br><map name="mymap"><br><area shape="rect" corrds="" href="" onclick=""><br></area><br></map><br>rect - 定义矩形区域<br>circle - 定义圆形区域<br>poly - 定义多边形区域<br>default - 定义整个区域</p><picture>  <source media="(min-width: 650px)" srcset="img_food.jpg">  <source media="(min-width: 465px)" srcset="img_car.jpg">  <img src="img_girl.jpg"><!--兜底元素--></picture><p>浏览器将使用其识别的第一种图像格式:<br><picture><br>  <source srcset="img_avatar.png"><br>  <source srcset="img_girl.jpg"><br>  <img src="img_beatles.gif" alt="Beatles" style="width:auto;"><br></picture></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Linux环回设备(loop device)</title>
    <link href="/2025/11/01/Linux%E7%8E%AF%E5%9B%9E%E8%AE%BE%E5%A4%87loop/"/>
    <url>/2025/11/01/Linux%E7%8E%AF%E5%9B%9E%E8%AE%BE%E5%A4%87loop/</url>
    
    <content type="html"><![CDATA[<h1 id="Linux-环回设备（loop-device）"><a href="#Linux-环回设备（loop-device）" class="headerlink" title="Linux 环回设备（loop device）"></a>Linux 环回设备（loop device）</h1><h2 id="一、概念"><a href="#一、概念" class="headerlink" title="一、概念"></a>一、概念</h2><p><strong>环回设备（loop device）</strong> 是一种虚拟块设备，它允许你把一个普通文件当作块设备（如硬盘或分区）来使用。<br>简单来说，它让一个文件“伪装成”一个磁盘设备，这样就可以对这个文件执行挂载（mount）、格式化等操作。</p><p>例如，你有一个镜像文件 <code>disk.img</code>，就可以通过 loop 设备把它挂载到系统中，像挂载真实磁盘一样使用。</p><hr><h2 id="二、基本用法"><a href="#二、基本用法" class="headerlink" title="二、基本用法"></a>二、基本用法</h2><h3 id="1-创建一个镜像文件"><a href="#1-创建一个镜像文件" class="headerlink" title="1. 创建一个镜像文件"></a>1. 创建一个镜像文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=disk.img bs=1M count=100<br></code></pre></td></tr></table></figure><p>这会创建一个 100MB 的空白文件。</p><hr><h3 id="2-通过-losetup-关联环回设备"><a href="#2-通过-losetup-关联环回设备" class="headerlink" title="2. 通过 losetup 关联环回设备"></a>2. 通过 <code>losetup</code> 关联环回设备</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> losetup /dev/loop0 disk.img<br></code></pre></td></tr></table></figure><p>查看环回设备：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">losetup -a<br></code></pre></td></tr></table></figure><p>解除关联：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> losetup -d /dev/loop0<br></code></pre></td></tr></table></figure><hr><h3 id="3-创建文件系统"><a href="#3-创建文件系统" class="headerlink" title="3. 创建文件系统"></a>3. 创建文件系统</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mkfs.ext4 /dev/loop0<br></code></pre></td></tr></table></figure><hr><h3 id="4-挂载到目录"><a href="#4-挂载到目录" class="headerlink" title="4. 挂载到目录"></a>4. 挂载到目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> /mnt/looptest<br><span class="hljs-built_in">sudo</span> mount /dev/loop0 /mnt/looptest<br></code></pre></td></tr></table></figure><p>现在 <code>/mnt/looptest</code> 下就像一个真实磁盘一样，可以读写文件。</p><hr><h3 id="5-卸载与清理"><a href="#5-卸载与清理" class="headerlink" title="5. 卸载与清理"></a>5. 卸载与清理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> umount /mnt/looptest<br><span class="hljs-built_in">sudo</span> losetup -d /dev/loop0<br></code></pre></td></tr></table></figure><hr><h2 id="三、快捷用法（自动分配-loop）"><a href="#三、快捷用法（自动分配-loop）" class="headerlink" title="三、快捷用法（自动分配 loop）"></a>三、快捷用法（自动分配 loop）</h2><p>可以直接通过 <code>mount -o loop</code> 自动完成设备绑定：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mount -o loop disk.img /mnt/looptest<br></code></pre></td></tr></table></figure><p>系统会自动选择一个空闲的 <code>/dev/loopX</code>。</p><hr><h2 id="四、优点"><a href="#四、优点" class="headerlink" title="四、优点"></a>四、优点</h2><ul><li><strong>便捷性</strong>：不需要真实磁盘，就可以测试挂载、文件系统操作。</li><li><strong>灵活性</strong>：可快速创建、销毁虚拟磁盘，方便实验或容器化环境使用。</li><li><strong>文件可移植</strong>：整个镜像文件可随时复制、备份或移动。</li><li><strong>安全性</strong>：不会影响真实磁盘分区。</li></ul><hr><h2 id="五、缺点"><a href="#五、缺点" class="headerlink" title="五、缺点"></a>五、缺点</h2><ul><li><strong>性能较低</strong>：本质上是文件读写的再封装，有额外的 I&#x2F;O 开销。</li><li><strong>不适合大规模存储</strong>：仅用于测试或轻量虚拟环境。（有些设备仅支持至32T）</li><li><strong>不能直接支持某些高级块设备特性</strong>（如直通、LVM、多队列 I&#x2F;O）。</li></ul><hr><h2 id="六、典型应用场景"><a href="#六、典型应用场景" class="headerlink" title="六、典型应用场景"></a>六、典型应用场景</h2><ul><li>制作或测试 Linux 镜像文件（如 <code>.iso</code>, <code>.img</code>）</li><li>容器或虚拟机的临时根文件系统</li><li>文件系统学习、格式化实验</li><li>加密卷（例如 <code>cryptsetup</code> 基于 loop 设备）</li></ul><hr><h2 id="七、总结"><a href="#七、总结" class="headerlink" title="七、总结"></a>七、总结</h2><table><thead><tr><th>功能</th><th>命令示例</th><th>说明</th></tr></thead><tbody><tr><td>创建镜像</td><td><code>dd if=/dev/zero of=disk.img bs=1M count=100</code></td><td>生成 100MB 文件</td></tr><tr><td>绑定 loop</td><td><code>losetup /dev/loop0 disk.img</code></td><td>将文件映射为块设备</td></tr><tr><td>创建文件系统</td><td><code>mkfs.ext4 /dev/loop0</code></td><td>格式化为 ext4</td></tr><tr><td>挂载</td><td><code>mount /dev/loop0 /mnt/looptest</code></td><td>像真实磁盘一样使用</td></tr><tr><td>卸载</td><td><code>umount /mnt/looptest &amp;&amp; losetup -d /dev/loop0</code></td><td>释放资源</td></tr></tbody></table><hr><p><strong>一句话总结：</strong><br>环回设备（loop device）是“用文件假装成磁盘”的机制，方便挂载、实验和镜像操作，但性能有限，主要用于测试和虚拟化场景。</p>]]></content>
    
    
    <categories>
      
      <category>DevOps &amp; 云原生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>async、await与Promise</title>
    <link href="/2025/10/20/async%E3%80%81await%E4%B8%8EPromise/"/>
    <url>/2025/10/20/async%E3%80%81await%E4%B8%8EPromise/</url>
    
    <content type="html"><![CDATA[<h2 id="一、async-标记的函数是什么？"><a href="#一、async-标记的函数是什么？" class="headerlink" title="一、async 标记的函数是什么？"></a>一、<code>async</code> 标记的函数是什么？</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>➡️ <strong>结论：<code>async</code> 标记的函数相当于一个 Promise 函数（即返回 Promise 对象的函数）</strong>。</p><p>解释：</p><ul><li>它本质是一个普通函数；</li><li>但调用后，<strong>返回一个 Promise 对象</strong>；</li><li>返回值 <code>123</code> 会被自动包装成 <code>Promise.resolve(123)</code>。</li></ul><p>验证：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> p = <span class="hljs-title function_">foo</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Promise</span>); <span class="hljs-comment">// ✅ true</span><br></code></pre></td></tr></table></figure><p>所以：</p><blockquote><p>✅ “<code>async</code> 标记的函数 ≠ Promise 对象本身”，<br>而是“<strong>返回 Promise 对象的函数</strong>”。</p></blockquote><h2 id="二、await-标记的是什么？"><a href="#二、await-标记的是什么？" class="headerlink" title="二、await 标记的是什么？"></a>二、<code>await</code> 标记的是什么？</h2><p><code>await</code> 用来<strong>等待一个 Promise 对象的结果</strong>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();<br></code></pre></td></tr></table></figure><ul><li>如果 <code>fetchData()</code> 返回一个 Promise（比如通过 async 定义的），<code>await</code> 会暂停当前函数，直到 Promise 被 resolve；</li><li>如果返回的不是 Promise，JS 会自动执行 <code>Promise.resolve(非Promise值)</code>，所以也可以等待一个普通值。</li></ul><p>👉 换句话说：</p><blockquote><p><code>await</code> <strong>后面通常接 Promise 对象</strong>（或任何可以转成 Promise 的值）。</p></blockquote><p>示例：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">await</span> <span class="hljs-number">123</span>; <span class="hljs-comment">// 等价于 await Promise.resolve(123)</span><br></code></pre></td></tr></table></figure><h2 id="三、Promise-all-接受的是什么？"><a href="#三、Promise-all-接受的是什么？" class="headerlink" title="三、Promise.all 接受的是什么？"></a>三、<code>Promise.all</code> 接受的是什么？</h2><p><code>Promise.all()</code> 接受的是 <strong>Promise 对象数组</strong>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([p1, p2, p3])<br></code></pre></td></tr></table></figure><p>如果你传进去函数，比如 <code>[foo, bar]</code>，是不会起作用的，必须执行成对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 错误 ❌</span><br><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([fetchA, fetchB]); <span class="hljs-comment">// 不会等待</span><br><br><span class="hljs-comment">// 正确 ✅</span><br><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">fetchA</span>(), <span class="hljs-title function_">fetchB</span>()]);<br></code></pre></td></tr></table></figure><h2 id="四、整体关系图-🧩"><a href="#四、整体关系图-🧩" class="headerlink" title="四、整体关系图 🧩"></a>四、整体关系图 🧩</h2><table><thead><tr><th>概念</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td><code>Promise</code></td><td>构造函数</td><td>用来 new 出 Promise 对象</td></tr><tr><td><code>Promise 对象</code></td><td>异步结果容器</td><td>有 then、catch 方法</td></tr><tr><td><code>async 函数</code></td><td>返回 Promise 的函数</td><td>是 Promise 的语法糖</td></tr><tr><td><code>await 表达式</code></td><td>Promise 解包工具</td><td>等待 Promise 结果</td></tr><tr><td><code>Promise.all([...])</code></td><td>Promise 组合器</td><td>接收 Promise 对象数组</td></tr></tbody></table><h2 id="五、简单示例-🌱"><a href="#五、简单示例-🌱" class="headerlink" title="五、简单示例 🌱"></a>五、简单示例 🌱</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getData</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchA</span>(); <span class="hljs-comment">// 等待 PromiseA</span><br>  <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchB</span>(); <span class="hljs-comment">// 等待 PromiseB</span><br>  <span class="hljs-keyword">return</span> a + b;             <span class="hljs-comment">// 自动封装成 Promise.resolve(a + b)</span><br>&#125;<br><br><span class="hljs-keyword">const</span> p = <span class="hljs-title function_">getData</span>(); <span class="hljs-comment">// 返回 Promise 对象</span><br>p.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)); <span class="hljs-comment">// 获取结果</span><br><br><span class="hljs-comment">// 并行执行</span><br><span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">fetchA</span>(), <span class="hljs-title function_">fetchB</span>()]);<br></code></pre></td></tr></table></figure><h2 id="六、Promise-链式调用"><a href="#六、Promise-链式调用" class="headerlink" title="六、Promise 链式调用"></a>六、Promise 链式调用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>))<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x + <span class="hljs-number">1</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">3</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x)); <span class="hljs-comment">// 输出 6</span><br></code></pre></td></tr></table></figure><p>每个 then 都返回一个新的 Promise，因此可以链式调用。</p><h2 id="七、常见坑"><a href="#七、常见坑" class="headerlink" title="七、常见坑"></a>七、常见坑</h2><p>不要在 forEach 中使用 await：<br>forEach 不会等待回调中的异步操作；<br>它只是按顺序立即调用所有回调函数；<br>如果回调是 async，那它会返回 Promise，但 forEach 不会处理它。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">arr.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> item =&gt; &#123;<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">doSomething</span>(item); <span class="hljs-comment">// ❌ 外部不会等待</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>正确写法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> arr) &#123;<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">doSomething</span>(item);<br>&#125;<br></code></pre></td></tr></table></figure><p>或并行执行：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(arr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title function_">doSomething</span>(item)));<br></code></pre></td></tr></table></figure><hr><h2 id="✅-一句话总结"><a href="#✅-一句话总结" class="headerlink" title="✅ 一句话总结"></a>✅ 一句话总结</h2><ul><li><code>async</code> 标记的函数 → <strong>返回 Promise 对象</strong>；</li><li><code>await</code> → <strong>等待 Promise 对象</strong>；</li><li><code>Promise.all()</code> → <strong>接受 Promise 对象数组</strong>。</li></ul>]]></content>
    
    
    <categories>
      
      <category>Web前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>异步</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker 离线安装与根目录迁移引发的思考</title>
    <link href="/2025/10/12/Docker-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%B8%8E%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%BF%81%E7%A7%BB%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83/"/>
    <url>/2025/10/12/Docker-%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E4%B8%8E%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%BF%81%E7%A7%BB%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83/</url>
    
    <content type="html"><![CDATA[<p>在一些 <strong>内网或隔离环境</strong>（如政企服务器、科研内网）中，无法直接联网执行 <code>apt install docker</code> 或 <code>yum install docker</code>。<br>这时就需要通过 <strong>离线安装 Docker</strong> 的方式来部署容器环境。<br>本文记录了我在离线安装 Docker 并迁移根目录（&#x2F;var&#x2F;lib&#x2F;docker）后的经验与踩坑总结 🧠</p><hr><h2 id="🧩-一、查看系统环境"><a href="#🧩-一、查看系统环境" class="headerlink" title="🧩 一、查看系统环境"></a>🧩 一、查看系统环境</h2><p>首先确定系统架构和版本，避免下载错误的二进制包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看系统架构（如 x86_64 或 aarch64）</span><br><span class="hljs-built_in">uname</span> -m<br><br><span class="hljs-comment"># 查看是否已有 Docker 版本</span><br>docker -v<br></code></pre></td></tr></table></figure><hr><h2 id="📦-二、下载-Docker-离线包"><a href="#📦-二、下载-Docker-离线包" class="headerlink" title="📦 二、下载 Docker 离线包"></a>📦 二、下载 Docker 离线包</h2><p>在可联网的机器上访问官方下载页：</p><p>👉 <a href="https://download.docker.com/linux/static/stable/">https://download.docker.com/linux/static/stable/</a></p><p>根据系统架构选择合适的 tar 包（例如 <code>docker-18.06.3-ce.tgz</code>）<br>然后将其拷贝到目标服务器上（使用 scp、U 盘等方式）。</p><hr><h2 id="🔧-三、离线安装步骤"><a href="#🔧-三、离线安装步骤" class="headerlink" title="🔧 三、离线安装步骤"></a>🔧 三、离线安装步骤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 解压二进制文件</span><br>tar -zxvf docker-18.06.3-ce.tgz<br><br><span class="hljs-comment"># 将可执行文件复制到系统路径</span><br><span class="hljs-built_in">cp</span> ./docker/* /usr/bin/<br></code></pre></td></tr></table></figure><p>接着创建并编辑 Docker 的 systemd 启动文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/systemd/system/<br><span class="hljs-built_in">touch</span> docker.service<br></code></pre></td></tr></table></figure><hr><h2 id="⚙️-四、编辑-docker-service"><a href="#⚙️-四、编辑-docker-service" class="headerlink" title="⚙️ 四、编辑 docker.service"></a>⚙️ 四、编辑 <code>docker.service</code></h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Docker Application Container Engine<br><span class="hljs-attr">Documentation</span>=https://docs.docker.com<br><span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target firewalld.service<br><span class="hljs-attr">Wants</span>=network-<span class="hljs-literal">on</span>line.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=notify<br><span class="hljs-attr">ExecStart</span>=/usr/bin/dockerd --selinux-enabled=<span class="hljs-literal">false</span> --insecure-registry=<span class="hljs-number">192.168</span>.<span class="hljs-number">205.230</span><br><span class="hljs-attr">ExecReload</span>=/bin/kill -s HUP <span class="hljs-variable">$MAINPID</span><br><span class="hljs-attr">LimitNOFILE</span>=infinity<br><span class="hljs-attr">LimitNPROC</span>=infinity<br><span class="hljs-attr">LimitCORE</span>=infinity<br><span class="hljs-attr">TimeoutStartSec</span>=<span class="hljs-number">0</span><br><span class="hljs-attr">Delegate</span>=<span class="hljs-literal">yes</span><br><span class="hljs-attr">KillMode</span>=process<br><span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure<br><span class="hljs-attr">StartLimitBurst</span>=<span class="hljs-number">3</span><br><span class="hljs-attr">StartLimitInterval</span>=<span class="hljs-number">60</span>s<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p>保存退出后：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x docker.service<br>systemctl daemon-reload<br>systemctl start docker<br>systemctl status docker<br>docker -v<br>systemctl <span class="hljs-built_in">enable</span> docker.service<br></code></pre></td></tr></table></figure><p>✅ 如果能正常显示版本号，说明安装成功。</p><hr><h2 id="📂-五、Docker-根目录迁移（-var-lib-docker）"><a href="#📂-五、Docker-根目录迁移（-var-lib-docker）" class="headerlink" title="📂 五、Docker 根目录迁移（&#x2F;var&#x2F;lib&#x2F;docker）"></a>📂 五、Docker 根目录迁移（&#x2F;var&#x2F;lib&#x2F;docker）</h2><p>默认情况下，Docker 的数据根目录为：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">/<span class="hljs-keyword">var</span>/lib/docker<br></code></pre></td></tr></table></figure><p>当系统盘空间较小或需要挂载独立磁盘时，可以将其迁移到其他目录。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 停止 Docker</span><br>systemctl stop docker<br><br><span class="hljs-comment"># 移动目录到新位置（例如 /data/docker）</span><br><span class="hljs-built_in">mv</span> /var/lib/docker /data/docker<br><br><span class="hljs-comment"># 修改 daemon.json</span><br>vi /etc/docker/daemon.json<br></code></pre></td></tr></table></figure><p>添加以下配置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;data-root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/data/docker&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>重新加载：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl daemon-reload<br>systemctl start docker<br></code></pre></td></tr></table></figure><hr><h2 id="🧠-六、关于根目录迁移的性能思考"><a href="#🧠-六、关于根目录迁移的性能思考" class="headerlink" title="🧠 六、关于根目录迁移的性能思考"></a>🧠 六、关于根目录迁移的性能思考</h2><p>在 Linux 系统中，Docker 默认使用 <strong>overlay2 联合文件系统</strong> 来管理镜像与容器层。<br>overlay2 的优势在于：</p><ul><li>文件共享高效</li><li>读写速度快</li><li>支持写时复制（Copy-on-Write）</li></ul><p>但当你将根目录迁移到 <strong>NFS 或网络存储挂载目录</strong> 时，Docker <strong>自动降级为 vfs 模式</strong>。</p><p>⚠️ 问题来了：</p><blockquote><p>vfs 不再具备写时复制、层合并等优化机制，镜像导入与容器启动会显著变慢（可能慢数十倍）。</p></blockquote><hr><h2 id="💬-七、总结与建议"><a href="#💬-七、总结与建议" class="headerlink" title="💬 七、总结与建议"></a>💬 七、总结与建议</h2><table><thead><tr><th>操作</th><th>建议</th><th>说明</th></tr></thead><tbody><tr><td>离线安装</td><td>✅ 官方静态二进制包</td><td>轻量稳定，避免依赖冲突</td></tr><tr><td>根目录迁移</td><td>✅ 可行，但需使用本地磁盘</td><td>避免 NFS &#x2F; vfs 降级</td></tr><tr><td>overlay2</td><td>🚀 性能优选</td><td>本地 ext4&#x2F;xfs 文件系统下效果最佳</td></tr><tr><td>vfs</td><td>⚠️ 仅在必要时使用</td><td>会极大降低性能</td></tr></tbody></table><hr><h2 id="🧭-八、参考资料"><a href="#🧭-八、参考资料" class="headerlink" title="🧭 八、参考资料"></a>🧭 八、参考资料</h2><ul><li><a href="https://docs.docker.com/engine/install/">Docker 官方文档</a></li><li><a href="https://blog.csdn.net/chexlong/article/details/127932711">CSDN: Linux 离线安装 Docker</a></li><li><a href="https://docs.docker.com/storage/storagedriver/">Docker 存储驱动说明</a></li></ul><hr><p>💡 <strong>思考一句话总结：</strong></p><blockquote><p>离线环境不是障碍，真正的挑战是理解 Docker 背后的存储与性能机制。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>DevOps &amp; 云原生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React 学习笔记(四): 变量管理 useRef + useMemo + useState</title>
    <link href="/2025/09/20/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9B%9B-%E5%8F%98%E9%87%8F%E7%AE%A1%E7%90%86useRef-useMemo-useState/"/>
    <url>/2025/09/20/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9B%9B-%E5%8F%98%E9%87%8F%E7%AE%A1%E7%90%86useRef-useMemo-useState/</url>
    
    <content type="html"><![CDATA[<h1 id="⚛️-React-Hook-学习笔记：useRef-vs-useMemo-vs-useState"><a href="#⚛️-React-Hook-学习笔记：useRef-vs-useMemo-vs-useState" class="headerlink" title="⚛️ React Hook 学习笔记：useRef vs useMemo vs useState"></a>⚛️ React Hook 学习笔记：<code>useRef</code> vs <code>useMemo</code> vs <code>useState</code></h1><p>这三个 Hook 都是 React 中的“状态管理 &amp; 性能优化”核心工具。<br>但它们的用途完全不同 👇</p><hr><h2 id="🧩-一、useState-——-管理组件状态（可触发渲染）"><a href="#🧩-一、useState-——-管理组件状态（可触发渲染）" class="headerlink" title="🧩 一、useState —— 管理组件状态（可触发渲染）"></a>🧩 一、<code>useState</code> —— 管理组件状态（可触发渲染）</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>点击次数：&#123;count&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/&gt;</span></span><br>);<br></code></pre></td></tr></table></figure><h3 id="✅-特点"><a href="#✅-特点" class="headerlink" title="✅ 特点"></a>✅ 特点</h3><ul><li><strong>用于保存“会影响 UI”的状态</strong></li><li><strong>更新会触发组件重新渲染</strong></li><li><strong>值在每次渲染中都是独立的</strong></li></ul><h3 id="⚠️-注意"><a href="#⚠️-注意" class="headerlink" title="⚠️ 注意"></a>⚠️ 注意</h3><ul><li>每次 <code>setCount</code> 都会重新渲染组件。</li><li>不适合存储不会显示在页面上的数据。</li></ul><hr><h2 id="🧠-二、useRef-——-保存引用（不会触发渲染）"><a href="#🧠-二、useRef-——-保存引用（不会触发渲染）" class="headerlink" title="🧠 二、useRef —— 保存引用（不会触发渲染）"></a>🧠 二、<code>useRef</code> —— 保存引用（不会触发渲染）</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">const</span> inputRef = useRef&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;(<span class="hljs-literal">null</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">focusInput</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  inputRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();<br>&#125;;<br><br><span class="hljs-keyword">return</span> (<br>  <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;inputRef&#125;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;点我聚焦试试&quot;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;focusInput&#125;</span>&gt;</span>聚焦输入框<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/&gt;</span></span><br>);<br></code></pre></td></tr></table></figure><h3 id="✅-特点-1"><a href="#✅-特点-1" class="headerlink" title="✅ 特点"></a>✅ 特点</h3><ul><li>保存一个<strong>可变的引用值</strong>，跨渲染周期不变。</li><li><strong>修改 <code>.current</code> 不会触发渲染</strong>。</li><li>常用于：<ul><li>访问 DOM 元素（如上例）</li><li>保存上一次的值、定时器 ID 等</li></ul></li></ul><h3 id="⚠️-注意-1"><a href="#⚠️-注意-1" class="headerlink" title="⚠️ 注意"></a>⚠️ 注意</h3><p><code>useRef</code> 是“静态的”，值变化不会更新 UI。</p><hr><h2 id="🚀-三、useMemo-——-性能优化（缓存计算结果）"><a href="#🚀-三、useMemo-——-性能优化（缓存计算结果）" class="headerlink" title="🚀 三、useMemo —— 性能优化（缓存计算结果）"></a>🚀 三、<code>useMemo</code> —— 性能优化（缓存计算结果）</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">const</span> expensiveValue = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;计算中...&quot;</span>);<br>  <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">d</span> =&gt;</span> d.<span class="hljs-property">active</span>).<span class="hljs-property">length</span>;<br>&#125;, [data]);<br></code></pre></td></tr></table></figure><h3 id="✅-特点-2"><a href="#✅-特点-2" class="headerlink" title="✅ 特点"></a>✅ 特点</h3><ul><li>缓存“<strong>计算结果</strong>”，避免每次渲染都重复执行。</li><li>仅当依赖项 <code>[data]</code> 变化时才重新计算。</li></ul><h3 id="⚙️-常见用途"><a href="#⚙️-常见用途" class="headerlink" title="⚙️ 常见用途"></a>⚙️ 常见用途</h3><ul><li>计算复杂数据（如排序、过滤）</li><li>避免子组件重复渲染（搭配 <code>React.memo</code>）</li></ul><h3 id="⚠️-注意-2"><a href="#⚠️-注意-2" class="headerlink" title="⚠️ 注意"></a>⚠️ 注意</h3><ul><li><strong>不会保存引用或状态，只缓存结果。</strong></li><li>依赖项一定要写对，否则缓存无效或错误。</li></ul><hr><h2 id="🧭-四、三者对比总结"><a href="#🧭-四、三者对比总结" class="headerlink" title="🧭 四、三者对比总结"></a>🧭 四、三者对比总结</h2><table><thead><tr><th>Hook</th><th>是否触发渲染</th><th>用途</th><th>示例场景</th></tr></thead><tbody><tr><td><code>useState</code></td><td>✅ 会</td><td>管理页面状态</td><td>按钮计数、表单输入</td></tr><tr><td><code>useRef</code></td><td>❌ 不会</td><td>保存引用或临时变量</td><td>获取 DOM、保存 timer</td></tr><tr><td><code>useMemo</code></td><td>⚙️ 不会（缓存结果）</td><td>性能优化（避免重复计算）</td><td>过滤、排序、大计算量函数</td></tr></tbody></table><hr><h2 id="💡-小结"><a href="#💡-小结" class="headerlink" title="💡 小结"></a>💡 小结</h2><ul><li>👉 想“保存数据并更新界面” → <code>useState</code>  </li><li>👉 想“保存数据但不渲染” → <code>useRef</code>  </li><li>👉 想“缓存计算结果” → <code>useMemo</code></li></ul>]]></content>
    
    
    <categories>
      
      <category>Web前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React 学习笔记(三): 状态管理 useContext + useReducer + useEffect</title>
    <link href="/2025/09/15/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%89-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86useContext-useReducer-useEffect/"/>
    <url>/2025/09/15/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%89-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86useContext-useReducer-useEffect/</url>
    
    <content type="html"><![CDATA[<p>在 React 中，如果你想在组件树中<strong>共享状态</strong>（比如用户信息、登录状态等），就可以用「<code>useContext</code> + <code>useReducer</code> + <code>useEffect</code>」这组组合拳 🥊。</p><p>整体流程大致是这样的👇：</p><blockquote><p><strong>前端 dispatch → reducer 响应 action → 控制状态如何变化</strong></p></blockquote><p>这就像是一个<strong>简化版 Redux</strong>，但不需要额外的库。</p><hr><h2 id="🧩-一、context-tsx"><a href="#🧩-一、context-tsx" class="headerlink" title="🧩 一、context.tsx"></a>🧩 一、context.tsx</h2><p>创建上下文（Context），用来保存全局的用户状态以及更新状态的函数 <code>dispatch</code>。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; createContext, useContext, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Dispatch</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">UserState</span>, <span class="hljs-title class_">UserAction</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;~/types/user&quot;</span>;<br><br><span class="hljs-comment">// 🎯 定义上下文中包含的内容</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserContextType</span> &#123;<br>    <span class="hljs-attr">state</span>: <span class="hljs-title class_">UserState</span>;<br>    <span class="hljs-attr">dispatch</span>: <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">UserAction</span>&gt;;<br>&#125;<br><br><span class="hljs-comment">// 🌍 创建上下文变量（初始值为 undefined）</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserContext</span> = createContext&lt;<span class="hljs-title class_">UserContextType</span> | <span class="hljs-literal">undefined</span>&gt;(<span class="hljs-literal">undefined</span>);<br></code></pre></td></tr></table></figure><blockquote><p>🧠 小结：</p><ul><li>state：存储用户信息</li><li>dispatch：触发状态改变的函数</li><li>UserContext：一个全局共享的数据源容器</li></ul></blockquote><h2 id="🧱-二、provider-tsx"><a href="#🧱-二、provider-tsx" class="headerlink" title="🧱 二、provider.tsx"></a>🧱 二、provider.tsx</h2><p><code>Provider</code> 就像一个“外层包裹器”📦，负责提供上下文中的数据（state）和操作方法（dispatch）给整个应用。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useContext, useEffect, useReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">UserContext</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">UserContextType</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./context&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; userReducer &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./reducer&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">UserState</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;~/types/user&quot;</span>;<br></code></pre></td></tr></table></figure><h3 id="🌱-初始化用户状态"><a href="#🌱-初始化用户状态" class="headerlink" title="🌱 初始化用户状态"></a>🌱 初始化用户状态</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">initialState</span>: <span class="hljs-title class_">UserState</span> = &#123;<br><span class="hljs-attr">authenticated</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-attr">user</span>: &#123;<br><span class="hljs-attr">id</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">name</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">phone</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">province</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">city</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">email</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">title</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">organization</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">introduction</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">roleId</span>: <span class="hljs-number">2</span>,<br><span class="hljs-attr">roleName</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">roleDesc</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">maxCpu</span>: <span class="hljs-number">2</span>,<br><span class="hljs-attr">maxStorage</span>: <span class="hljs-number">5</span>,<br><span class="hljs-attr">maxJob</span>: <span class="hljs-number">3</span>,<br><span class="hljs-attr">isSuperAdmin</span>: <span class="hljs-literal">false</span>,<br>&#125;,<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="🧩-创建自定义-Hook"><a href="#🧩-创建自定义-Hook" class="headerlink" title="🧩 创建自定义 Hook"></a>🧩 创建自定义 Hook</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useUserContext</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br><span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);<br><span class="hljs-keyword">if</span> (!context)<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;useUserContext 必须在 UserProvider 中使用！&quot;</span>);<br><span class="hljs-keyword">return</span> context;<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>📌 这样任何组件都可以通过 useUserContext() 来获取全局用户状态。</p></blockquote><h3 id="💡-UserProvider-组件"><a href="#💡-UserProvider-组件" class="headerlink" title="💡 UserProvider 组件"></a>💡 UserProvider 组件</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserProvider</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;&#123; <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span> &#125;&gt; = <span class="hljs-function">(<span class="hljs-params">&#123; children &#125;</span>) =&gt;</span> &#123;<br><span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(userReducer, initialState, <span class="hljs-function">(<span class="hljs-params">init</span>) =&gt;</span> &#123;<br><span class="hljs-comment">// 🧭 LAZY INITIALIZER：从 localStorage 读取用户状态</span><br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">const</span> storedUser = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;user&quot;</span>);<br><span class="hljs-keyword">const</span> userId = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;userId&quot;</span>);<br><span class="hljs-keyword">if</span> (userId &amp;&amp; storedUser) &#123;<br><span class="hljs-keyword">return</span> &#123;<br><span class="hljs-attr">authenticated</span>: <span class="hljs-literal">true</span>,<br><span class="hljs-attr">user</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(storedUser),<br>&#125;;<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (e) &#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);<br>&#125;<br><span class="hljs-keyword">return</span> init; <span class="hljs-comment">// 默认初始值</span><br>&#125;);<br><br><span class="hljs-comment">// ✅ 副作用：同步 localStorage（持久化用户状态）</span><br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><span class="hljs-keyword">if</span> (state.<span class="hljs-property">authenticated</span>) &#123;<br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(state.<span class="hljs-property">user</span>));<br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;userId&quot;</span>, state.<span class="hljs-property">user</span>.<span class="hljs-property">id</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;user&quot;</span>);<br><span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">&quot;userId&quot;</span>);<br>&#125;<br>&#125;, [state]);<br><br><span class="hljs-comment">// 🌍 提供上下文（state + dispatch）</span><br><span class="hljs-keyword">return</span> (<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">dispatch</span> &#125;&#125;&gt;</span></span><br><span class="language-xml">&#123;children&#125;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span><br>);<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>🧠 这里做了三件事：</p><ul><li>使用 useReducer 管理状态；</li><li>用 useEffect 实现本地持久化（同步到 localStorage）；</li><li>用 &lt;UserContext.Provider&gt; 将 state 和 dispatch 向全局提供。</li></ul></blockquote><h2 id="⚙️-三、reducer-tsx"><a href="#⚙️-三、reducer-tsx" class="headerlink" title="⚙️ 三、reducer.tsx"></a>⚙️ 三、reducer.tsx</h2><p><code>reducer</code> 是状态的“大脑” 🧠，<br>决定在不同的 action 下状态如何变化。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">UserState</span>, <span class="hljs-title class_">UserAction</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;~/types/user&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">userReducer</span>(<span class="hljs-params"><span class="hljs-attr">state</span>: <span class="hljs-title class_">UserState</span>, <span class="hljs-attr">action</span>: <span class="hljs-title class_">UserAction</span></span>): <span class="hljs-title class_">UserState</span> &#123;<br><span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;LOGIN&quot;</span>:<br><span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">authenticated</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">user</span>: action.<span class="hljs-property">payload</span> &#125;;<br><br><span class="hljs-keyword">case</span> <span class="hljs-string">&quot;LOGOUT&quot;</span>:<br><span class="hljs-keyword">return</span> &#123;<br><span class="hljs-attr">authenticated</span>: <span class="hljs-literal">false</span>,<br><span class="hljs-attr">user</span>: &#123;<br><span class="hljs-attr">id</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">name</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">phone</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">province</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">city</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">email</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">title</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">organization</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">introduction</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">roleId</span>: <span class="hljs-number">2</span>,<br><span class="hljs-attr">roleName</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">roleDesc</span>: <span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">maxCpu</span>: <span class="hljs-number">2</span>,<br><span class="hljs-attr">maxStorage</span>: <span class="hljs-number">5</span>,<br><span class="hljs-attr">maxJob</span>: <span class="hljs-number">3</span>,<br><span class="hljs-attr">isSuperAdmin</span>: <span class="hljs-literal">false</span>,<br>&#125;,<br>&#125;;<br><br><span class="hljs-attr">default</span>:<br><span class="hljs-keyword">return</span> state;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>📘 小贴士：</p><ul><li>action.type 表示动作类型，比如 “LOGIN”、”LOGOUT”</li><li>action.payload 是携带的数据</li><li>reducer 必须是纯函数（不能直接修改 state）</li></ul></blockquote><h2 id="🎨-四、使用示例"><a href="#🎨-四、使用示例" class="headerlink" title="🎨 四、使用示例"></a>🎨 四、使用示例</h2><p>有了上面的 Provider，我们在页面中可以这样用👇：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginButton</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">const</span> &#123; dispatch &#125; = <span class="hljs-title function_">useUserContext</span>();<br><br><span class="hljs-keyword">return</span> (<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span></span><br><span class="language-xml">dispatch(&#123; type: &quot;LOGIN&quot;, payload: &#123; id: &quot;1&quot;, name: &quot;Paxton&quot; &#125; &#125;)</span><br><span class="language-xml">&#125;</span><br><span class="language-xml">&gt;</span><br><span class="language-xml">登录</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br>);<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserInfo</span>(<span class="hljs-params"></span>) &#123;<br><span class="hljs-keyword">const</span> &#123; state &#125; = <span class="hljs-title function_">useUserContext</span>();<br><br><span class="hljs-keyword">return</span> (<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">&#123;state.authenticated ? (</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>欢迎回来，&#123;state.user.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">) : (</span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>请先登录 🙈<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">)&#125;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br>&#125;<br></code></pre></td></tr></table></figure><p>然后在最外层包裹应用：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;<span class="hljs-title class_">UserProvider</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br>&lt;/<span class="hljs-title class_">UserProvider</span>&gt;<br></code></pre></td></tr></table></figure><p>这样 <code>App</code> 中的所有组件都能共享登录状态 ✅。</p><h2 id="🧭-整体关系图"><a href="#🧭-整体关系图" class="headerlink" title="🧭 整体关系图"></a>🧭 整体关系图</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss">组件 → <span class="hljs-built_in">dispatch</span>(action)<br>        ↓<br>     <span class="hljs-built_in">reducer</span>(state, action)<br>        ↓<br>     新的 state<br>        ↓<br>   Context Provider<br>        ↓<br> 所有 <span class="hljs-built_in">useUserContext</span>() 的组件更新<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React 学习笔记(二): React项目框架构建</title>
    <link href="/2025/09/08/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C-React%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6%E6%9E%84%E5%BB%BA/"/>
    <url>/2025/09/08/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%BA%8C-React%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6%E6%9E%84%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h2 id="1️⃣-创建项目"><a href="#1️⃣-创建项目" class="headerlink" title="1️⃣ 创建项目"></a>1️⃣ 创建项目</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 由react官方推荐的react router v7创建项目</span><br>npx create-react-router@latest<br><span class="hljs-comment"># 安装eslint插件</span><br>npm install --save-dev eslint-config-react-app eslint@^8.0.0<br><span class="hljs-comment"># 安装antd UI库</span><br>npm i antd --save<br><span class="hljs-comment"># 安装antd针对react 19的兼容包</span><br>npm install @ant-design/v5-patch-for-react-19 --save <br><span class="hljs-comment"># 安装tailwind插件</span><br>npm i tailwind-scrollbar-hide<br><span class="hljs-comment"># 运行项目</span><br>npm run dev<br></code></pre></td></tr></table></figure><h2 id="2️⃣-页面框架搭建"><a href="#2️⃣-页面框架搭建" class="headerlink" title="2️⃣ 页面框架搭建"></a>2️⃣ 页面框架搭建</h2><h3 id="目录构建"><a href="#目录构建" class="headerlink" title="目录构建"></a>目录构建</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs stylus">├── Dockerfile<br>├── README<span class="hljs-selector-class">.md</span><br>├── app<br>│   ├── app<span class="hljs-selector-class">.css</span><br>│   ├── assets<br>│   │   ├── menu-logo-slim<span class="hljs-selector-class">.svg</span><br>│   │   └── menu-logo<span class="hljs-selector-class">.svg</span><br>│   ├── components<br>│   ├── layouts<br>│   │   ├── scripts<br>│   │   │   └── menus<span class="hljs-selector-class">.tsx</span><br>│   │   └── vertical-dashboard<span class="hljs-selector-class">.tsx</span><br>│   ├── pages<br>│   ├── root<span class="hljs-selector-class">.tsx</span><br>│   ├── routes<br>│   │   ├── dashboard<span class="hljs-selector-class">.tsx</span><br>│   │   └── home<span class="hljs-selector-class">.tsx</span><br>│   ├── routes<span class="hljs-selector-class">.ts</span><br>│   └── welcome<br>│       ├── logo-dark<span class="hljs-selector-class">.svg</span><br>│       ├── logo-light<span class="hljs-selector-class">.svg</span><br>│       └── welcome<span class="hljs-selector-class">.tsx</span><br>├── package-lock<span class="hljs-selector-class">.json</span><br>├── package<span class="hljs-selector-class">.json</span><br>├── public<br>│   └── favicon<span class="hljs-selector-class">.ico</span><br>├── react-router<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.ts</span><br>├── tsconfig<span class="hljs-selector-class">.json</span><br>└── vite<span class="hljs-selector-class">.config</span>.ts<br></code></pre></td></tr></table></figure><h3 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// react-router.config.ts</span><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">Config</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@react-router/dev/config&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-comment">// Config options...</span><br>  <span class="hljs-comment">// Server-side render by default, to enable SPA mode set this to `false`</span><br>  <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span>,<br>&#125; <span class="hljs-keyword">satisfies</span> <span class="hljs-title class_">Config</span>;<br><br><span class="hljs-comment">// .prettierrc</span><br>&#123;<br>    <span class="hljs-string">&quot;tabWidth&quot;</span>: <span class="hljs-number">4</span>,<br>    <span class="hljs-string">&quot;useTabs&quot;</span>: <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// app/routes.ts</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">type</span> <span class="hljs-title class_">RouteConfig</span>, index, route &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@react-router/dev/routes&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [<br>    <span class="hljs-comment">// 对应文件不能用具名导出</span><br>    <span class="hljs-title function_">route</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;routes/dashboard.tsx&quot;</span>, [<br>        <span class="hljs-title function_">index</span>(<span class="hljs-string">&quot;routes/home.tsx&quot;</span>),<br>        <span class="hljs-title function_">route</span>(<span class="hljs-string">&quot;dashboard&quot;</span>, <span class="hljs-string">&quot;welcome/welcome.tsx&quot;</span>),<br>        <span class="hljs-title function_">route</span>(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;welcome/welcome.tsx&quot;</span>)<br>    ]),<br>] <span class="hljs-keyword">satisfies</span> <span class="hljs-title class_">RouteConfig</span>;<br></code></pre></td></tr></table></figure><h3 id="Layout配置"><a href="#Layout配置" class="headerlink" title="Layout配置"></a>Layout配置</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// ------app/root.tsx添加：------</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;@ant-design/v5-patch-for-react-19&quot;</span>;<br><br><span class="hljs-comment">// ------app/layouts/vertical-dashboard.tsx------</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, &#123; useMemo, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123;<br><span class="hljs-title class_">VerticalRightOutlined</span>,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@ant-design/icons&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">MenuProps</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;antd&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Breadcrumb</span>, <span class="hljs-title class_">Layout</span>, <span class="hljs-title class_">Menu</span>, theme, <span class="hljs-title class_">Tooltip</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;antd&quot;</span>;<br><span class="hljs-keyword">import</span> menuLogo <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;~/assets/menu-logo.svg&quot;</span>;<br><span class="hljs-keyword">import</span> menuLogoSlim <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;~/assets/menu-logo-slim.svg&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Outlet</span>, useLocation, useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; items &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./scripts/menus&quot;</span>;<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Header</span>, <span class="hljs-title class_">Content</span>, <span class="hljs-title class_">Footer</span>, <span class="hljs-title class_">Sider</span> &#125; = <span class="hljs-title class_">Layout</span>;<br><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">VerticalDashboardLayout</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> &#123;<br><span class="hljs-keyword">const</span> [collapsed, setCollapsed] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br><span class="hljs-keyword">const</span> &#123;<br><span class="hljs-attr">token</span>: &#123; colorBgContainer, borderRadiusLG &#125;,<br>&#125; = theme.<span class="hljs-title function_">useToken</span>();<br><span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">selectedMenuItems</span>: <span class="hljs-built_in">string</span>[] = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><span class="hljs-keyword">return</span> [location.<span class="hljs-property">pathname</span>];<br>&#125;, [location.<span class="hljs-property">pathname</span>]);<br><span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">handleMenuClick</span>: <span class="hljs-title class_">MenuProps</span>[<span class="hljs-string">&quot;onClick&quot;</span>] = <span class="hljs-function">(<span class="hljs-params">&#123; key &#125;</span>) =&gt;</span> &#123;<br><span class="hljs-title function_">navigate</span>(key);<br>&#125;;<br><br><span class="hljs-keyword">return</span> (<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;h-screen&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Sider</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">trigger</span>=<span class="hljs-string">&#123;null&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">collapsible</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">width</span>=<span class="hljs-string">&#123;250&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">collapsed</span>=<span class="hljs-string">&#123;collapsed&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">className</span>=<span class="hljs-string">&quot;h-screen overflow-y-auto scrollbar-hide&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;demo-logo-vertical relative pb-1 pt-1&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">absolute</span> <span class="hljs-attr">top-0.5</span> <span class="hljs-attr">right-0.5</span> <span class="hljs-attr">text-</span>[#<span class="hljs-attr">e8e8e8</span>] <span class="hljs-attr">cursor-pointer</span> $&#123;<span class="hljs-attr">collapsed</span> &amp;&amp; &quot;<span class="hljs-attr">hidden</span>&quot;&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">VerticalRightOutlined</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCollapsed(true)&#125;</span><br><span class="language-xml">/&gt;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">src</span>=<span class="hljs-string">&#123;menuLogo&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;React Router&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">block</span> <span class="hljs-attr">w-full</span> $&#123;<span class="hljs-attr">collapsed</span> &amp;&amp; &quot;<span class="hljs-attr">hidden</span>&quot;&#125;`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">/&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Expand Menu&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">src</span>=<span class="hljs-string">&#123;menuLogoSlim&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;React Router&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">className</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">block</span> <span class="hljs-attr">w-full</span> $&#123;<span class="hljs-attr">collapsed</span> || &quot;<span class="hljs-attr">hidden</span>&quot;&#125; <span class="hljs-attr">cursor-pointer</span>`&#125;</span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setCollapsed(false)&#125;</span><br><span class="language-xml">/&gt;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Tooltip</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Menu</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">theme</span>=<span class="hljs-string">&quot;dark&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">selectedKeys</span>=<span class="hljs-string">&#123;selectedMenuItems&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">defaultSelectedKeys</span>=<span class="hljs-string">&#123;[</span>&quot;/<span class="hljs-attr">dashboard</span>&quot;]&#125;</span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">mode</span>=<span class="hljs-string">&quot;inline&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">items</span>=<span class="hljs-string">&#123;items&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleMenuClick&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">/&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Sider</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;h-screen overflow-auto&quot;</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">0</span>, <span class="hljs-attr">background:</span> <span class="hljs-attr">colorBgContainer</span> &#125;&#125; /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Content</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">margin:</span> &quot;<span class="hljs-attr">0</span> <span class="hljs-attr">16px</span>&quot;, <span class="hljs-attr">paddingTop:</span> &quot;<span class="hljs-attr">16px</span>&quot; &#125;&#125;&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">padding:</span> <span class="hljs-attr">24</span>,</span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">minHeight:</span> <span class="hljs-attr">360</span>,</span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">background:</span> <span class="hljs-attr">colorBgContainer</span>,</span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">borderRadius:</span> <span class="hljs-attr">borderRadiusLG</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">&#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Content</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">textAlign:</span> &quot;<span class="hljs-attr">center</span>&quot; &#125;&#125;&gt;</span></span><br><span class="language-xml">Copyright ©&#123;new Date().getFullYear()&#125; Created by OpenGMS</span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Footer</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span></span><br>);<br>&#125;;<br><br><span class="hljs-comment">// ------app/layouts/scripts/menus.tsx------</span><br><span class="hljs-keyword">import</span> &#123;<br><span class="hljs-title class_">SettingOutlined</span>,<br><span class="hljs-title class_">TeamOutlined</span>,<br><span class="hljs-title class_">AuditOutlined</span>,<br><span class="hljs-title class_">UserOutlined</span>,<br><span class="hljs-title class_">DatabaseOutlined</span>,<br><span class="hljs-title class_">ConsoleSqlOutlined</span>,<br><span class="hljs-title class_">ControlOutlined</span>,<br><span class="hljs-title class_">FileProtectOutlined</span>,<br><span class="hljs-title class_">GlobalOutlined</span>,<br><span class="hljs-title class_">BlockOutlined</span>,<br><span class="hljs-title class_">ClearOutlined</span>,<br><span class="hljs-title class_">ProductOutlined</span>,<br><span class="hljs-title class_">DashboardOutlined</span>,<br><span class="hljs-title class_">VerticalRightOutlined</span>,<br><span class="hljs-title class_">InboxOutlined</span>,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@ant-design/icons&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">MenuProps</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;antd&quot;</span>;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">MenuItem</span> = <span class="hljs-title class_">Required</span>&lt;<span class="hljs-title class_">MenuProps</span>&gt;[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-built_in">number</span>];<br><br><span class="hljs-comment">// 具名导出</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">items</span>: <span class="hljs-title class_">MenuItem</span>[] = [<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/dashboard&quot;</span>, <span class="hljs-comment">// 如果不加/就会按相对路径解析</span><br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;工作台&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DashboardOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;1&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;用户&quot;</span>,<br><span class="hljs-attr">type</span>: <span class="hljs-string">&quot;group&quot;</span>,<br><span class="hljs-attr">children</span>: [<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/user&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;用户管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/role&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;角色管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TeamOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/permission&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;权限配置&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AuditOutlined</span> /&gt;</span></span>,<br>&#125;,<br>],<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;2&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;数据&quot;</span>,<br><span class="hljs-attr">type</span>: <span class="hljs-string">&quot;group&quot;</span>,<br><span class="hljs-attr">children</span>: [<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/sensor&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;传感器信息管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">GlobalOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/product&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;产品信息管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">InboxOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/satellite&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;遥感数据管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">DatabaseOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/vector&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;矢量数据管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">BlockOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/theme&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;栅格产品管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductOutlined</span> /&gt;</span></span>,<br>&#125;,<br>],<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;3&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;运维&quot;</span>,<br><span class="hljs-attr">type</span>: <span class="hljs-string">&quot;group&quot;</span>,<br><span class="hljs-attr">children</span>: [<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/cache&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;缓存管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ClearOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/sql&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;SQL监控&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ConsoleSqlOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/audit&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;日志审查&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FileProtectOutlined</span> /&gt;</span></span>,<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/task&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;任务管理&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ControlOutlined</span> /&gt;</span></span>,<br>&#125;,<br>],<br>&#125;,<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;4&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;配置&quot;</span>,<br><span class="hljs-attr">type</span>: <span class="hljs-string">&quot;group&quot;</span>,<br><span class="hljs-attr">children</span>: [<br>&#123;<br><span class="hljs-attr">key</span>: <span class="hljs-string">&quot;/config&quot;</span>,<br><span class="hljs-attr">label</span>: <span class="hljs-string">&quot;系统参数&quot;</span>,<br><span class="hljs-attr">icon</span>: <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SettingOutlined</span> /&gt;</span></span>,<br>&#125;,<br>],<br>&#125;,<br>];<br><br><span class="hljs-comment">// ------ app/routes/dashboard.tsx ------</span><br><span class="hljs-comment">// 命名导入</span><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">Route</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./+types/dashboard&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">VerticalDashboardLayout</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../layouts/vertical-dashboard&quot;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">meta</span>(<span class="hljs-params">&#123;&#125;: <span class="hljs-title class_">Route</span>.<span class="hljs-title class_">MetaArgs</span></span>) &#123;<br>    <span class="hljs-keyword">return</span> [<br>      &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;ARD后台管理系统&quot;</span> &#125;,<br>      &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;description&quot;</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">&quot;Welcome to React Router!&quot;</span> &#125;,<br>    ];<br>  &#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Dashboard</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">VerticalDashboardLayout</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/&gt;</span></span><br>    );<br>&#125;<br><br><span class="hljs-comment">// ------app/routes/home.tsx------</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Redirect to Dashboard</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">Route</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./+types/home&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useEffect &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; useNavigate &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-router&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">meta</span>(<span class="hljs-params">&#123;&#125;: <span class="hljs-title class_">Route</span>.<span class="hljs-title class_">MetaArgs</span></span>) &#123;<br><span class="hljs-keyword">return</span> [<br>&#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;New React Router App&quot;</span> &#125;,<br>&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;description&quot;</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">&quot;Welcome to React Router!&quot;</span> &#125;,<br>];<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();<br><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title function_">navigate</span>(<span class="hljs-string">&quot;/dashboard&quot;</span>)<br>  &#125;);<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3️⃣-运行"><a href="#3️⃣-运行" class="headerlink" title="3️⃣ 运行"></a>3️⃣ 运行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm run dev -- --host<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ray 集群容器化部署</title>
    <link href="/2025/09/08/Ray-%E9%9B%86%E7%BE%A4%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"/>
    <url>/2025/09/08/Ray-%E9%9B%86%E7%BE%A4%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文演示如何用 Docker 启动一个 Ray 集群（1 主 + 多工作节点），并说明关键参数与常见问题。适用于在同一二层网络或使用 host 网络的场景。</p></blockquote><h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><ul><li>Docker 已安装并可用（rootless&#x2F;标准均可）</li><li>可访问的镜像 <code>model-server:0812</code>（包含 Ray 及你的服务）</li><li>所有节点时间同步、网络互通（尤其是 6379、8265、你的服务端口）</li><li>资源规划：CPU&#x2F;内存&#x2F;共享内存（&#x2F;dev&#x2F;shm）</li></ul><h2 id="启动主节点（Head）"><a href="#启动主节点（Head）" class="headerlink" title="启动主节点（Head）"></a>启动主节点（Head）</h2><p>通过 <code>ray start</code> 启动主节点容器，并开启 Dashboard 与资源限制：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 启动主节点（Head）</span><br>docker run -d --name ray-head \<br>  -p 5000:5000 \            <span class="hljs-comment"># 映射自定义 API 服务端口（示例）</span><br>  -p 6379:6379 \             <span class="hljs-comment"># Ray 集群内部通信端口（GCS）</span><br>  -p 8265:8265 \             <span class="hljs-comment"># Ray Dashboard 端口</span><br>  -v /mnt/volumes/modelServer:/usr/resource \  <span class="hljs-comment"># 业务资源挂载</span><br>  --network=host \           <span class="hljs-comment"># 与宿主机共享网络（见下方注意事项）</span><br>  -w /usr/resource \          <span class="hljs-comment"># 工作目录</span><br>  --restart=always \          <span class="hljs-comment"># 异常退出自动重启</span><br>  --privileged=<span class="hljs-literal">true</span> \         <span class="hljs-comment"># （如非必要可移除）</span><br>  --shm-size=13gb \           <span class="hljs-comment"># 共享内存，需 &gt; object-store-memory</span><br>  model-server:0812 bash -c \<br>  <span class="hljs-string">&quot;ray start \</span><br><span class="hljs-string">    --include-dashboard=True \</span><br><span class="hljs-string">    --head \</span><br><span class="hljs-string">    --node-ip-address=0.0.0.0 \           # 监听地址</span><br><span class="hljs-string">    --port=6379 \                          # GCS 端口</span><br><span class="hljs-string">    --dashboard-host=0.0.0.0 \             # Dashboard 绑定地址</span><br><span class="hljs-string">    --num-cpus=36 \                        # 此节点可用 CPU 数</span><br><span class="hljs-string">    --memory=80000000000 \                 # 可用内存（bytes）</span><br><span class="hljs-string">    --object-store-memory=12000000000 \    # 对象存储内存（bytes）</span><br><span class="hljs-string">    &amp;&amp; python -m dataProcessing.server&quot;</span>     <span class="hljs-comment"># 启动你的业务服务</span><br><br><span class="hljs-comment"># 检查启动日志</span><br>docker logs ray-head<br></code></pre></td></tr></table></figure><ul><li><strong>端口说明</strong>：<ul><li><strong>5000</strong>：示例中的业务 API 服务（可按需调整）</li><li><strong>6379</strong>：Ray Head 的 GCS 端口（Worker 通过此端口加入）</li><li><strong>8265</strong>：Ray Dashboard（Web UI）</li></ul></li><li><strong>网络模式</strong>：示例使用 <code>--network=host</code>，确保所有节点能直连 Head 的 <code>6379/8265</code>。在云环境（如公有云）中，host 网络需谨慎；</li><li><strong>共享内存</strong>：<code>--shm-size</code> 必须大于 <code>--object-store-memory</code>，否则对象存储易 OOM 或报错。</li><li><strong>privileged</strong>：通常不必需，建议移除，除非你的服务确实需要。</li></ul><h2 id="启动工作节点（Worker）"><a href="#启动工作节点（Worker）" class="headerlink" title="启动工作节点（Worker）"></a>启动工作节点（Worker）</h2><p>每个 Worker 通过 <code>--address=&#39;&lt;HEAD_IP&gt;:6379&#39;</code> 加入集群：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 启动工作节点 1</span><br>docker run -d --name ray-worker_1 \<br>  --shm-size=13gb \<br>  --network=host \<br>  -v /mnt/volumes/modelServer:/usr/resource \<br>  model-server:0812 bash -c \<br>  <span class="hljs-string">&quot;ray start \</span><br><span class="hljs-string">    --address=&#x27;172.31.13.23:6379&#x27; \   # 替换为 Head 节点实际 IP:PORT</span><br><span class="hljs-string">    --num-cpus=36 \                   # 分配给该 Worker 的 CPU 数</span><br><span class="hljs-string">    --memory=80000000000 \            # 该 Worker 可用内存（bytes）</span><br><span class="hljs-string">    --object-store-memory=12000000000 \  # 该 Worker 对象存储内存</span><br><span class="hljs-string">    --block&quot;</span>                          <span class="hljs-comment"># 前台阻塞，容器保持运行</span><br></code></pre></td></tr></table></figure><ul><li>多个 Worker 可重复上述命令，修改容器名与资源参数。</li><li>若非 host 网络，需确保容器能访问到 Head 的 <code>6379</code> 端口（映射端口或内网解析）。</li></ul><h2 id="Python-端连接与资源注解"><a href="#Python-端连接与资源注解" class="headerlink" title="Python 端连接与资源注解"></a>Python 端连接与资源注解</h2><p>在 Python 中连接已启动的 Ray 集群：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> ray<br><br><span class="hljs-comment"># 集群模式：使用已存在的 Head（ray start 启动）</span><br>ray.init(address=<span class="hljs-string">&quot;auto&quot;</span>)<br><br><span class="hljs-meta">@ray.remote(<span class="hljs-params">num_cpus=<span class="hljs-number">4</span>, memory=<span class="hljs-number">12</span> * <span class="hljs-number">1024</span>**<span class="hljs-number">3</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_task</span>():<br>    ...<br></code></pre></td></tr></table></figure><ul><li><strong>重要区别</strong>：<ul><li>集群模式下，资源（CPU&#x2F;内存&#x2F;对象存储）应主要在 <code>ray start</code> 层面配置。</li><li><code>ray.init(_memory=...)</code> 更适用于单机调试（不通过 <code>ray start</code> 手动起节点），在集群中不生效或不建议依赖。</li></ul></li></ul><h2 id="验证与可视化"><a href="#验证与可视化" class="headerlink" title="验证与可视化"></a>验证与可视化</h2><ul><li>访问 Dashboard：<code>http://172.31.13.23:8265</code>（替换为 Head IP）</li><li>在 Python 中验证：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> ray<br><span class="hljs-built_in">print</span>(ray.is_initialized())<br><span class="hljs-built_in">print</span>(ray.available_resources())<br></code></pre></td></tr></table></figure><h2 id="常见问题与修正建议"><a href="#常见问题与修正建议" class="headerlink" title="常见问题与修正建议"></a>常见问题与修正建议</h2><ul><li>注意：<code>--network=host</code> 与 <code>-p</code> 同时使用在大多数 Docker 版本中无效（host 模式会忽略 <code>-p</code>）。</li><li>资源单位为字节，容易写错。示例中 <code>--memory=80000000000</code> &#x3D; 80 GB ≈ 74.5 GiB，<code>--object-store-memory=12000000000</code> ≈ 11.2 GiB，请按物理资源调整。</li><li><code>--privileged=true</code> 非必要，建议移除以降低安全风险。</li></ul>]]></content>
    
    
    <categories>
      
      <category>DevOps &amp; 云原生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>Ray</tag>
      
      <tag>分布式计算</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>React 学习笔记(一): 起步的一些问题记录</title>
    <link href="/2025/09/07/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%80-%E8%B5%B7%E6%AD%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <url>/2025/09/07/React-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%80-%E8%B5%B7%E6%AD%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="1️⃣-js-逻辑与"><a href="#1️⃣-js-逻辑与" class="headerlink" title="1️⃣ js 逻辑与 &amp;&amp;"></a>1️⃣ js 逻辑与 <code>&amp;&amp;</code></h2><ul><li>强类型语言，一定会返回<code>true</code>或<code>false</code></li><li>弱类型语言，例如python和js，按照<strong>短路求值</strong>和<strong>真值&#x2F;假值</strong>机制，返回其中一个操作数，而不是强制布尔值。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-string">&quot;hi&quot;</span> &amp;&amp; <span class="hljs-number">123</span>   <span class="hljs-comment">// =&gt; 123</span><br><span class="hljs-number">0</span> &amp;&amp; <span class="hljs-string">&quot;hi&quot;</span>     <span class="hljs-comment">// =&gt; 0</span><br><span class="hljs-literal">false</span> &amp;&amp; <span class="hljs-string">&quot;hi&quot;</span> <span class="hljs-comment">// =&gt; false</span><br></code></pre></td></tr></table></figure><p>所以以下两种写法等价：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;&gt;<br>&#123;<br>isLoggedIn ? (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span></span>) : (<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">LoginPanel</span> /&gt;</span></span>)<br>&#125;<br>&lt;/&gt;<br><br><span class="hljs-comment">// 当你不需要else分支时：</span><br><span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">&#123; isLoggedIn &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span> &#125;</span><br><span class="language-xml"><span class="hljs-tag">&lt;/&gt;</span></span><br></code></pre></td></tr></table></figure><blockquote><p>注意⚠️： 在React中，忽略 <code>false</code>、<code>null</code>、<code>undefined</code> → 不渲染任何东西；</p></blockquote><h2 id="2️⃣-React-渲染逻辑"><a href="#2️⃣-React-渲染逻辑" class="headerlink" title="2️⃣ React 渲染逻辑"></a>2️⃣ React 渲染逻辑</h2><p><code>&lt;AdminPanel /&gt;</code> 会被React编译，返回一个React元素描述对象，而不是以调用函数的形式直接运行组件函数。</p><p>例如编译前：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&lt;&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> /&gt;</span></span><br>&lt;/&gt;<br></code></pre></td></tr></table></figure><p>编译后：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">AdminPanel</span>, <span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">// React 17后：</span><br><span class="hljs-keyword">import</span> &#123; jsx <span class="hljs-keyword">as</span> _jsx &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react/jsx-runtime&quot;</span>;<br><span class="hljs-title function_">_jsx</span>(<span class="hljs-title class_">AdminPanel</span>, &#123;&#125;);<br><br><span class="hljs-comment">// 返回值，也即React元素对象长这样：</span><br>&#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-title class_">AdminPanel</span>,<br>  <span class="hljs-attr">props</span>: &#123;&#125;,<br>  <span class="hljs-attr">key</span>: <span class="hljs-literal">null</span>,<br>  <span class="hljs-attr">ref</span>: <span class="hljs-literal">null</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3️⃣-React-duplicate-route-id"><a href="#3️⃣-React-duplicate-route-id" class="headerlink" title="3️⃣ React duplicate route id"></a>3️⃣ React duplicate route id</h2><h3 id="🐛-写法-A"><a href="#🐛-写法-A" class="headerlink" title="🐛 写法 A"></a>🐛 写法 A</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [<br>    <span class="hljs-title function_">index</span>(<span class="hljs-string">&quot;routes/home.tsx&quot;</span>),      <span class="hljs-comment">// 默认路由 /</span><br>    <span class="hljs-title function_">route</span>(<span class="hljs-string">&quot;home&quot;</span>, <span class="hljs-string">&quot;routes/home.tsx&quot;</span>) <span class="hljs-comment">// /home</span><br>] <span class="hljs-keyword">satisfies</span> <span class="hljs-title class_">RouteConfig</span>;<br></code></pre></td></tr></table></figure><blockquote><p>写法A 做了什么?</p></blockquote><ul><li><p>内部生成的 routeId &#x3D; 文件路径 → “routes&#x2F;home”</p></li><li><p>故react报错duplicate route id</p></li></ul><h3 id="✅-写法-B-正确示例"><a href="#✅-写法-B-正确示例" class="headerlink" title="✅ 写法 B 正确示例"></a>✅ 写法 B 正确示例</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [<br>    <span class="hljs-title function_">route</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;routes/home.tsx&quot;</span>, &#123; <span class="hljs-attr">id</span>: <span class="hljs-string">&quot;your-route-id&quot;</span>&#125;),    <span class="hljs-comment">// /</span><br>    <span class="hljs-title function_">route</span>(<span class="hljs-string">&quot;home&quot;</span>, <span class="hljs-string">&quot;routes/home.tsx&quot;</span>)  <span class="hljs-comment">// /home</span><br>] <span class="hljs-keyword">satisfies</span> <span class="hljs-title class_">RouteConfig</span>;<br></code></pre></td></tr></table></figure><h2 id="4️⃣-默认导出与具名导出"><a href="#4️⃣-默认导出与具名导出" class="headerlink" title="4️⃣ 默认导出与具名导出"></a>4️⃣ 默认导出与具名导出</h2><h3 id="默认导出"><a href="#默认导出" class="headerlink" title="默认导出"></a>默认导出</h3><ul><li><p>一个文件只能有 一个默认导出</p></li><li><p>导入时可以随意命名</p></li></ul><p>示例：</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// MyComponent.tsx</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello Default Export<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">MyComponent</span>;<br><br><span class="hljs-comment">// App.tsx</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AnyName</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./MyComponent&quot;</span>; <span class="hljs-comment">// 可以随意命名</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AnyName</span> /&gt;</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>✅ 特点：</p><ul><li><p>导入名称可以自定义</p></li><li><p>只能导出一个默认值</p><blockquote><p>注意⚠️ routes.ts中导入的路由文件只能默认导出。例如routes&#x2F;home.tsx必须用默认导出方式</p></blockquote></li></ul><h3 id="具名导出（named-export）"><a href="#具名导出（named-export）" class="headerlink" title="具名导出（named export）"></a>具名导出（named export）</h3><ul><li><p>一个文件可以有 多个具名导出</p></li><li><p>导入时必须使用 花括号 {} 并且名称必须匹配</p></li></ul><p>示例：</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// MyComponent.tsx</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">Header</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">Footer</span> = (<span class="hljs-params"></span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span></span>;<br><br><span class="hljs-comment">// App.tsx</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Header</span>, <span class="hljs-title class_">Footer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./MyComponent&quot;</span>; <span class="hljs-comment">// 必须用原名称</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure><p>✅ 特点：</p><ul><li><p>可以导出多个函数&#x2F;组件&#x2F;变量</p></li><li><p>导入时名称必须和导出时一致（可以用 as 改名）</p></li></ul><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Header</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Top</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./MyComponent&quot;</span>;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Top</span> /&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="5️⃣-路由的绝对路径与相对路径"><a href="#5️⃣-路由的绝对路径与相对路径" class="headerlink" title="5️⃣ 路由的绝对路径与相对路径"></a>5️⃣ 路由的绝对路径与相对路径</h2><blockquote><p>⚠️ 绝对路径以<code>/</code>开头，相对路径不以<code>/</code>开头</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Web前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>React</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>全栈技术员知识图</title>
    <link href="/2025/09/07/%E5%85%A8%E6%A0%88%E6%8A%80%E6%9C%AF%E5%91%98%E7%9F%A5%E8%AF%86%E5%9B%BE/"/>
    <url>/2025/09/07/%E5%85%A8%E6%A0%88%E6%8A%80%E6%9C%AF%E5%91%98%E7%9F%A5%E8%AF%86%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="前端开发"><a href="#前端开发" class="headerlink" title="前端开发"></a>前端开发</h2><ul><li>基础：HTML &#x2F; CSS &#x2F; JavaScript</li><li>框架与库：Vue、React、Angular、Svelte</li><li>UI 框架：Element Plus、Ant Design、Tailwind CSS、Vuetify</li><li>前端工程化：Vite、Webpack、Rollup、Babel、ESLint</li><li>前端性能优化：首屏优化、懒加载、Tree-shaking、缓存机制</li><li>跨端开发：Flutter、React Native、Electron</li></ul><h2 id="后端开发"><a href="#后端开发" class="headerlink" title="后端开发"></a>后端开发</h2><ul><li>语言与框架：Node.js（Express、NestJS、Koa）、Java（Spring Boot）、Python（Django、FastAPI）、Go</li><li>数据库：MySQL、PostgreSQL、MongoDB、Redis</li><li>ORM 与数据访问：MyBatis、TypeORM、Prisma、SQLAlchemy</li><li>API 设计：RESTful、GraphQL、gRPC</li><li>认证与安全：JWT、OAuth2、RBAC、CSRF&#x2F;XSS 防护</li></ul><h2 id="DevOps-云原生"><a href="#DevOps-云原生" class="headerlink" title="DevOps &amp; 云原生"></a>DevOps &amp; 云原生</h2><ul><li>容器化：Docker、Podman</li><li>编排：Kubernetes、Helm</li><li>CI&#x2F;CD：GitHub Actions、GitLab CI、Jenkins</li><li>监控与日志：Prometheus、Grafana、ELK、Loki</li><li>云服务：AWS、Azure、阿里云、腾讯云</li></ul><h2 id="全栈进阶"><a href="#全栈进阶" class="headerlink" title="全栈进阶"></a>全栈进阶</h2><ul><li>架构设计：微服务、单体、Serverless、CQRS</li><li>设计模式：MVC、MVVM、DDD</li><li>消息队列：Kafka、RabbitMQ、RocketMQ</li><li>搜索与缓存：Elasticsearch、Redis、Memcached</li><li>数据可视化：ECharts、D3.js、OpenLayers、Mapbox</li></ul><h2 id="工具与效率"><a href="#工具与效率" class="headerlink" title="工具与效率"></a>工具与效率</h2><ul><li>版本控制：Git、GitHub&#x2F;GitLab、Git Flow</li><li>开发工具：VS Code、JetBrains 系列、命令行工具</li><li>自动化测试：Jest、Mocha、Cypress、Playwright</li><li>调试与排错：Chrome DevTools、Postman、Wireshark</li></ul><h2 id="项目与实践"><a href="#项目与实践" class="headerlink" title="项目与实践"></a>项目与实践</h2><ul><li>个人项目实战：从零搭建博客系统、图片管理系统、聊天应用</li><li>企业级项目经验：微服务架构、分布式存储、权限管理</li><li>最佳实践总结：代码规范、部署方案、性能优化</li><li>开发踩坑记录：错误排查、坑点总结、迁移经验</li></ul><h2 id="职业成长"><a href="#职业成长" class="headerlink" title="职业成长"></a>职业成长</h2><ul><li>学习笔记：书籍、课程、技术大会</li><li>面试与求职：算法与数据结构、系统设计、真实面试题</li><li>职业规划：全栈成长路径、软技能、团队协作</li><li>行业趋势：AI 与 Web 融合、WebAssembly、边缘计算</li></ul><h2 id="生活随笔（选填）"><a href="#生活随笔（选填）" class="headerlink" title="生活随笔（选填）"></a>生活随笔（选填）</h2><ul><li>日常记录：旅行、摄影、生活感悟</li><li>效率方法论：时间管理、学习方法</li><li>思考与分享：对技术趋势的思考、个人成长故事</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>学习路线</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MinIO数据迁移rclone实践</title>
    <link href="/2025/09/06/MinIO%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BBrclone%E5%AE%9E%E8%B7%B5/"/>
    <url>/2025/09/06/MinIO%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BBrclone%E5%AE%9E%E8%B7%B5/</url>
    
    <content type="html"><![CDATA[<p>笔者之前采用MinIO官方工具mc进行数据迁移，可能是由于网络波动，经常会出现同步的数据不全、数据部分缺失的情况</p><h2 id="1️⃣-关于-rclone-的可靠性"><a href="#1️⃣-关于-rclone-的可靠性" class="headerlink" title="1️⃣ 关于 rclone 的可靠性"></a>1️⃣ 关于 rclone 的可靠性</h2><p>rclone 本身是一个成熟的开源工具，支持多种存储后端（包括 MinIO&#x2F;S3 兼容）。它可以：</p><ul><li><p><strong>完整复制</strong>文件（支持校验）。</p></li><li><p><strong>增量同步</strong>，只传新文件或修改文件。</p></li><li><p>支持 <strong>断点续传</strong>。</p></li><li><p>支持 <strong>多平台</strong>运行：Linux、Windows、MacOS 均原生支持。</p></li></ul><p><strong>注意事项</strong>：</p><ul><li><p>rclone 默认使用 MD5 或 SHA1 哈希来校验源文件和目标文件，可以确保文件完整性。</p></li><li><p>对于大文件，rclone 会分块上传，出现中断可以自动续传。</p></li><li><p>但如果迁移过程中出现系统 crash、网络中断或者误操作，仍可能出现“部分文件未同步”。因此，必须在方案中加入多次校验机制。</p></li></ul><h2 id="2️⃣-数据迁移可靠方案"><a href="#2️⃣-数据迁移可靠方案" class="headerlink" title="2️⃣ 数据迁移可靠方案"></a>2️⃣ 数据迁移可靠方案</h2><h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a><strong>前提</strong></h3><ul><li><p>旧 MinIO 单节点：<code>source</code></p></li><li><p>新 MinIO 集群：<code>target</code></p></li><li><p>使用 rclone 访问 S3 API，保证 <code>access_key</code>、<code>secret_key</code> 正确。</p></li><li><p>假设数据存放在 <code>bucket-name</code> 桶里。</p></li></ul><hr><h3 id="方案步骤"><a href="#方案步骤" class="headerlink" title="方案步骤"></a><strong>方案步骤</strong></h3><h4 id="Step-1：配置-rclone"><a href="#Step-1：配置-rclone" class="headerlink" title="Step 1：配置 rclone"></a><strong>Step 1：配置 rclone</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">rclone config <br><span class="hljs-comment"># 创建 source 和 target remote </span><br><span class="hljs-comment"># type: s3 </span><br><span class="hljs-comment"># provider: MinIO </span><br><span class="hljs-comment"># access_key_id &amp; secret_access_key </span><br><span class="hljs-comment"># endpoint: http://old-minio:9000 / http://new-minio:9000</span><br></code></pre></td></tr></table></figure><hr><h4 id="Step-2：全量迁移（第一次）"><a href="#Step-2：全量迁移（第一次）" class="headerlink" title="Step 2：全量迁移（第一次）"></a><strong>Step 2：全量迁移（第一次）</strong></h4><p>使用 <code>rclone sync</code> 或 <code>rclone copy</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rclone <span class="hljs-built_in">sync</span> <span class="hljs-built_in">source</span>:bucket-name target:bucket-name --progress    --checksum   --transfers=8   --checkers=16    --verbose  --retries=10<br></code></pre></td></tr></table></figure><p>说明：</p><ul><li><p><code>--checksum</code>：通过 hash 校验文件完整性，而不仅仅是时间戳。</p></li><li><p><code>--transfers</code>、<code>--checkers</code>：并发数量，可根据网络调整。</p></li><li><p><code>--retries</code>：失败自动重试。</p></li><li><p><code>sync</code> vs <code>copy</code>：</p><ul><li><p><code>copy</code>：不会删除目标桶已有文件。</p></li><li><p><code>sync</code>：保证源和目标完全一致，目标多余文件会被删除。<strong>谨慎使用</strong>，生产环境推荐先用 <code>copy</code> 做迁移，再用 <code>sync</code> 做校验。</p></li></ul></li></ul><hr><h4 id="Step-3：校验完整性"><a href="#Step-3：校验完整性" class="headerlink" title="Step 3：校验完整性"></a><strong>Step 3：校验完整性</strong></h4><ol><li>使用 rclone 的 <code>check</code> 命令：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rclone check <span class="hljs-built_in">source</span>:bucket-name target:bucket-name --one-way --size-only<br></code></pre></td></tr></table></figure><ul><li><p><code>--one-way</code>：只检查目标缺失或不一致的文件。</p></li><li><p><code>--size-only</code> 或 <code>--checksum</code>：建议使用 <code>--checksum</code> 做严格校验。</p></li></ul><p><strong>逻辑</strong>：</p><ul><li><p>检查结果为空 → 表示所有文件传输完整。</p></li><li><p>有文件缺失 → 再次使用 <code>rclone copy</code> 补传。</p></li></ul><hr><h4 id="Step-4：增量同步"><a href="#Step-4：增量同步" class="headerlink" title="Step 4：增量同步"></a><strong>Step 4：增量同步</strong></h4><p>在初次全量迁移后，旧 MinIO 可能仍在写新文件。此时采用增量同步：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rclone copy <span class="hljs-built_in">source</span>:bucket-name target:bucket-name \     --checksum \     --update \     --progress \     --retries=10<br></code></pre></td></tr></table></figure><p>说明：</p><ul><li><p><code>--update</code>：只同步源中新或被修改的文件。</p></li><li><p>可定期（如每小时、每天）执行。</p></li><li><p>每次增量同步后，再用 <code>rclone check</code> 做完整性校验。</p></li></ul><hr><h4 id="Step-5：最终确认"><a href="#Step-5：最终确认" class="headerlink" title="Step 5：最终确认"></a><strong>Step 5：最终确认</strong></h4><ol><li>全量+增量同步完成后，再次执行：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rclone check <span class="hljs-built_in">source</span>:bucket-name target:bucket-name --checksum<br></code></pre></td></tr></table></figure><p>确保无差异。<br>2. 可选：在目标 MinIO 上开启 <strong>桶版本控制</strong>，以防误删。</p><hr><h3 id="Step-6：自动化与日志"><a href="#Step-6：自动化与日志" class="headerlink" title="Step 6：自动化与日志"></a><strong>Step 6：自动化与日志</strong></h3><ul><li><p>在 Linux 上可以用 cron 定时同步增量。</p></li><li><p>日志建议写到文件：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rclone copy ... &gt;&gt; /var/log/rclone_migration.log 2&gt;&amp;1<br></code></pre></td></tr></table></figure><ul><li>对重要数据，建议在迁移完成后做一次<strong>MD5&#x2F;SHA256 校验</strong>，可用 <code>rclone md5sum</code> 或 <code>sha256sum</code>。</li></ul><hr><h2 id="3️⃣-跨平台可行性"><a href="#3️⃣-跨平台可行性" class="headerlink" title="3️⃣ 跨平台可行性"></a>3️⃣ 跨平台可行性</h2><p>rclone 官方支持：</p><ul><li><p><strong>Linux</strong>：二进制、Snap、包管理器安装。</p></li><li><p><strong>Windows</strong>：可执行文件（exe）。</p></li><li><p><strong>MacOS</strong>：Homebrew 安装或直接下载二进制。</p></li><li><p>同一命令行语法一致，无需改动。</p></li></ul><p>所以你的迁移策略可以在三平台通用。</p><hr><h2 id="4️⃣-总结"><a href="#4️⃣-总结" class="headerlink" title="4️⃣ 总结"></a>4️⃣ 总结</h2><p>为了保证“一条数据都不漏，每条都完整”：</p><ol><li><p><strong>第一次全量迁移</strong> → <code>rclone sync</code> &#x2F; <code>rclone copy</code> + <code>--checksum</code></p></li><li><p><strong>校验完整性</strong> → <code>rclone check</code>（或 md5sum）</p></li><li><p><strong>增量同步</strong> → 定期 <code>rclone copy --update --checksum</code></p></li><li><p><strong>最终确认</strong> → 再次 <code>rclone check</code></p></li><li><p><strong>可选</strong>：开启版本控制或日志审计</p></li></ol><p>使用 rclone 可以保证<strong>数据完整、断点续传、跨平台</strong>，只要严格执行“全量→校验→增量→校验”的流程，就可以做到零漏数据。</p>]]></content>
    
    
    <categories>
      
      <category>工具与效率</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MinIO rclone 数据迁移</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MinIO 分布式部署（Kubernetes）</title>
    <link href="/2025/09/05/MinIO-%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%EF%BC%88Kubernetes%EF%BC%89/"/>
    <url>/2025/09/05/MinIO-%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%EF%BC%88Kubernetes%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h2 id="📋-目录"><a href="#📋-目录" class="headerlink" title="📋 目录"></a>📋 目录</h2><ul><li><a href="#%E9%83%A8%E7%BD%B2%E5%89%8D%E5%87%86%E5%A4%87">部署前准备</a></li><li><a href="#kubernetes-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84">Kubernetes 部署架构</a></li><li><a href="#yaml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3">YAML 配置文件详解</a></li><li><a href="#%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4">部署步骤</a></li><li><a href="#docker-vs-kubernetes-%E5%AF%B9%E6%AF%94">Docker vs Kubernetes 对比</a></li><li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">常见问题与注意事项</a></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li></ul><h2 id="部署前准备"><a href="#部署前准备" class="headerlink" title="部署前准备"></a>部署前准备</h2><h3 id="检查存储类"><a href="#检查存储类" class="headerlink" title="检查存储类"></a>检查存储类</h3><p>在开始部署之前，确保你的 Kubernetes 集群有可用的存储类：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl get storageclass<br></code></pre></td></tr></table></figure><blockquote><p>⚠️ <strong>重要</strong>：如果没有默认的存储类，PVC 将无法绑定，导致 Pod 启动失败</p></blockquote><h3 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h3><ul><li>Kubernetes 集群（建议 1.20+）</li><li>可用的存储类（如 NFS、Ceph 等）</li><li>至少 4 个节点以获得最佳性能</li><li>足够的存储空间（建议每个节点 5GB+）</li></ul><h2 id="Kubernetes-部署架构"><a href="#Kubernetes-部署架构" class="headerlink" title="Kubernetes 部署架构"></a>Kubernetes 部署架构</h2><h3 id="组件说明"><a href="#组件说明" class="headerlink" title="组件说明"></a>组件说明</h3><table><thead><tr><th>组件</th><th>作用</th><th>特点</th></tr></thead><tbody><tr><td><strong>StatefulSet</strong></td><td>管理有状态 Pod</td><td>固定网络身份、有序部署</td></tr><tr><td><strong>Headless Service</strong></td><td>Pod 间服务发现</td><td>无 ClusterIP，提供 DNS 解析</td></tr><tr><td><strong>NodePort Service</strong></td><td>对外暴露服务</td><td>通过节点端口访问</td></tr><tr><td><strong>PVC</strong></td><td>持久化存储</td><td>自动绑定，数据持久化</td></tr></tbody></table><h2 id="YAML-配置文件详解"><a href="#YAML-配置文件详解" class="headerlink" title="YAML 配置文件详解"></a>YAML 配置文件详解</h2><h3 id="1️⃣-Headless-Service"><a href="#1️⃣-Headless-Service" class="headerlink" title="1️⃣ Headless Service"></a>1️⃣ Headless Service</h3><p><strong>作用</strong>：为 StatefulSet 提供固定域名解析，实现 Pod 间服务发现</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">minio-hl-svc</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">satellite-micro</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">clusterIP:</span> <span class="hljs-string">None</span>   <span class="hljs-comment"># 关键：Headless Service</span><br>  <span class="hljs-attr">publishNotReadyAddresses:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">minio</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">api</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9000</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">console</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9001</span><br></code></pre></td></tr></table></figure><p><strong>关键配置说明</strong>：</p><ul><li><code>clusterIP: None</code>：创建 Headless Service</li><li><code>publishNotReadyAddresses: true</code>：即使 Pod 未就绪也发布地址</li></ul><h3 id="2️⃣-NodePort-Service"><a href="#2️⃣-NodePort-Service" class="headerlink" title="2️⃣ NodePort Service"></a>2️⃣ NodePort Service</h3><p><strong>作用</strong>：对外暴露 MinIO 服务，提供外部访问入口</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">minio-svc</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">satellite-micro</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">NodePort</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">minio</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">api</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9000</span><br>      <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30900</span>   <span class="hljs-comment"># 自定义节点端口</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">console</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">9001</span><br>      <span class="hljs-attr">nodePort:</span> <span class="hljs-number">30901</span>   <span class="hljs-comment"># 自定义节点端口</span><br></code></pre></td></tr></table></figure><p><strong>端口映射</strong>：</p><ul><li><code>30900</code>：MinIO API 接口</li><li><code>30901</code>：MinIO 管理控制台</li></ul><h3 id="3️⃣-StatefulSet"><a href="#3️⃣-StatefulSet" class="headerlink" title="3️⃣ StatefulSet"></a>3️⃣ StatefulSet</h3><p><strong>作用</strong>：管理 MinIO Pod 和 PVC，确保有状态服务的稳定性</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">StatefulSet</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">minio</span><br>  <span class="hljs-attr">namespace:</span> <span class="hljs-string">satellite-micro</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">serviceName:</span> <span class="hljs-string">minio-hl-svc</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">4</span>  <span class="hljs-comment"># 四个节点</span><br>  <span class="hljs-attr">podManagementPolicy:</span> <span class="hljs-string">Parallel</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">minio</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">minio</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">securityContext:</span><br>        <span class="hljs-attr">fsGroup:</span> <span class="hljs-number">1000</span><br>      <span class="hljs-attr">affinity:</span><br>        <span class="hljs-attr">podAntiAffinity:</span>   <span class="hljs-comment"># 尽量把 Pod 分散到不同节点</span><br>          <span class="hljs-attr">preferredDuringSchedulingIgnoredDuringExecution:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">weight:</span> <span class="hljs-number">100</span><br>              <span class="hljs-attr">podAffinityTerm:</span><br>                <span class="hljs-attr">labelSelector:</span><br>                  <span class="hljs-attr">matchExpressions:</span><br>                    <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">app</span><br>                      <span class="hljs-attr">operator:</span> <span class="hljs-string">In</span><br>                      <span class="hljs-attr">values:</span> [<span class="hljs-string">&quot;minio&quot;</span>]<br>                <span class="hljs-attr">topologyKey:</span> <span class="hljs-string">kubernetes.io/hostname</span><br>      <span class="hljs-attr">containers:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">minio</span><br>          <span class="hljs-attr">image:</span> <span class="hljs-number">223.2</span><span class="hljs-number">.44</span><span class="hljs-number">.251</span><span class="hljs-string">/satellite/minio:latest</span><br>          <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">IfNotPresent</span><br>          <span class="hljs-attr">args:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">server</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--address=:9000</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">--console-address=:9001</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">http://minio-&#123;0...3&#125;.minio-hl-svc.satellite-micro.svc.cluster.local:9000/data</span><br>          <span class="hljs-attr">env:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MINIO_ROOT_USER</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;minioadmin&quot;</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MINIO_ROOT_PASSWORD</span><br>              <span class="hljs-attr">value:</span> <span class="hljs-string">&quot;minioadmin&quot;</span><br>          <span class="hljs-attr">ports:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">api</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9000</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">console</span><br>              <span class="hljs-attr">containerPort:</span> <span class="hljs-number">9001</span><br>          <span class="hljs-attr">volumeMounts:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">data</span><br>              <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/data</span><br>          <span class="hljs-attr">readinessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/minio/health/ready</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">20</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span><br>          <span class="hljs-attr">livenessProbe:</span><br>            <span class="hljs-attr">httpGet:</span><br>              <span class="hljs-attr">path:</span> <span class="hljs-string">/minio/health/live</span><br>              <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span><br>            <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">120</span><br>            <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">20</span><br>  <span class="hljs-attr">volumeClaimTemplates:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">metadata:</span><br>        <span class="hljs-attr">name:</span> <span class="hljs-string">data</span><br>      <span class="hljs-attr">spec:</span><br>        <span class="hljs-attr">accessModes:</span> [<span class="hljs-string">&quot;ReadWriteOnce&quot;</span>]<br>        <span class="hljs-attr">storageClassName:</span> <span class="hljs-string">nfs-client</span>   <span class="hljs-comment"># 使用你的存储类</span><br>        <span class="hljs-attr">resources:</span><br>          <span class="hljs-attr">requests:</span><br>            <span class="hljs-attr">storage:</span> <span class="hljs-string">5Gi</span><br></code></pre></td></tr></table></figure><h3 id="关键配置解析"><a href="#关键配置解析" class="headerlink" title="关键配置解析"></a>关键配置解析</h3><h4 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 分布式节点地址（0-3 顺序不要随意改）</span><br><span class="hljs-string">http://minio-&#123;0...3&#125;.minio-hl-svc.satellite-micro.svc.cluster.local:9000/data</span><br></code></pre></td></tr></table></figure><h4 id="健康检查"><a href="#健康检查" class="headerlink" title="健康检查"></a>健康检查</h4><ul><li><strong>就绪探针</strong>：检查服务是否准备好接收流量</li><li><strong>存活探针</strong>：检查服务是否正常运行</li></ul><h4 id="存储配置"><a href="#存储配置" class="headerlink" title="存储配置"></a>存储配置</h4><ul><li><strong>PVC 模板</strong>：自动为每个 Pod 创建独立的存储卷</li><li><strong>存储类</strong>：根据你的集群环境选择合适的存储类</li></ul><h2 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h2><h3 id="1-创建配置文件"><a href="#1-创建配置文件" class="headerlink" title="1. 创建配置文件"></a>1. 创建配置文件</h3><p>将上述 YAML 内容分别保存为：</p><ul><li><code>01-minio-headless-svc.yaml</code></li><li><code>02-minio-svc.yaml</code></li><li><code>03-minio-statefulset.yaml</code></li></ul><h3 id="2-按顺序部署"><a href="#2-按顺序部署" class="headerlink" title="2. 按顺序部署"></a>2. 按顺序部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 创建 Headless Service</span><br>kubectl apply -f 01-minio-headless-svc.yaml<br><br><span class="hljs-comment"># 2. 创建 NodePort Service</span><br>kubectl apply -f 02-minio-svc.yaml<br><br><span class="hljs-comment"># 3. 创建 StatefulSet</span><br>kubectl apply -f 03-minio-statefulset.yaml<br></code></pre></td></tr></table></figure><h3 id="3-验证部署"><a href="#3-验证部署" class="headerlink" title="3. 验证部署"></a>3. 验证部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 检查 Pod 状态</span><br>kubectl get pods -n satellite-micro<br><br><span class="hljs-comment"># 检查 Service</span><br>kubectl get svc -n satellite-micro<br><br><span class="hljs-comment"># 检查 PVC</span><br>kubectl get pvc -n satellite-micro<br><br><span class="hljs-comment"># 查看 Pod 日志</span><br>kubectl logs -f minio-0 -n satellite-micro<br></code></pre></td></tr></table></figure><h3 id="4-访问服务"><a href="#4-访问服务" class="headerlink" title="4. 访问服务"></a>4. 访问服务</h3><p>部署完成后，通过以下方式访问：</p><ul><li><strong>API 接口</strong>：<code>http://your-node-ip:30900</code></li><li><strong>管理控制台</strong>：<code>http://your-node-ip:30901</code></li></ul><h2 id="Docker-vs-Kubernetes-对比"><a href="#Docker-vs-Kubernetes-对比" class="headerlink" title="Docker vs Kubernetes 对比"></a>Docker vs Kubernetes 对比</h2><h3 id="1️⃣-Docker-分布式模式"><a href="#1️⃣-Docker-分布式模式" class="headerlink" title="1️⃣ Docker 分布式模式"></a>1️⃣ Docker 分布式模式</h3><p><strong>特点</strong>：需要手动配置网络和存储</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 需要手动配置 hosts 文件</span><br>minio-0 10.0.0.1<br>minio-1 10.0.0.2<br>minio-2 10.0.0.3<br>minio-3 10.0.0.4<br><br><span class="hljs-comment"># 启动命令</span><br>minio server http://minio-0/data http://minio-1/data http://minio-2/data http://minio-3/data<br></code></pre></td></tr></table></figure><p><strong>缺点</strong>：</p><ul><li>需要手动管理网络配置</li><li>存储管理复杂</li><li>扩缩容困难</li><li>缺乏自动故障恢复</li></ul><h3 id="2️⃣-Kubernetes-StatefulSet-模式"><a href="#2️⃣-Kubernetes-StatefulSet-模式" class="headerlink" title="2️⃣ Kubernetes StatefulSet 模式"></a>2️⃣ Kubernetes StatefulSet 模式</h3><p><strong>特点</strong>：自动化管理，高可用性</p><h4 id="自动服务发现"><a href="#自动服务发现" class="headerlink" title="自动服务发现"></a>自动服务发现</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Pod 固定命名</span><br><span class="hljs-string">minio-0,</span> <span class="hljs-string">minio-1,</span> <span class="hljs-string">minio-2,</span> <span class="hljs-string">minio-3</span><br><br><span class="hljs-comment"># DNS 自动解析</span><br><span class="hljs-string">minio-0.minio-hl-svc.satellite-micro.svc.cluster.local</span><br><span class="hljs-string">minio-1.minio-hl-svc.satellite-micro.svc.cluster.local</span><br><span class="hljs-comment"># ...</span><br></code></pre></td></tr></table></figure><h4 id="优势对比"><a href="#优势对比" class="headerlink" title="优势对比"></a>优势对比</h4><table><thead><tr><th>特性</th><th>Docker</th><th>Kubernetes</th></tr></thead><tbody><tr><td><strong>服务发现</strong></td><td>手动配置 hosts</td><td>DNS 自动解析</td></tr><tr><td><strong>存储管理</strong></td><td>手动挂载</td><td>PVC 自动绑定</td></tr><tr><td><strong>扩缩容</strong></td><td>复杂</td><td>简单（修改 replicas）</td></tr><tr><td><strong>故障恢复</strong></td><td>手动处理</td><td>自动重启</td></tr><tr><td><strong>负载均衡</strong></td><td>需要 Nginx</td><td>Service 自动处理</td></tr><tr><td><strong>监控</strong></td><td>需要额外工具</td><td>原生支持</td></tr></tbody></table><h2 id="常见问题与注意事项"><a href="#常见问题与注意事项" class="headerlink" title="常见问题与注意事项"></a>常见问题与注意事项</h2><h3 id="⚠️-重要提醒"><a href="#⚠️-重要提醒" class="headerlink" title="⚠️ 重要提醒"></a>⚠️ 重要提醒</h3><ol><li><strong>节点顺序</strong>：<code>minio-&#123;0...3&#125;</code> 中的 0-3 顺序不要随意改动</li><li><strong>存储类</strong>：确保 <code>storageClassName</code> 与你的集群环境匹配</li><li><strong>命名空间</strong>：所有资源必须在同一个命名空间中</li><li><strong>网络策略</strong>：确保 Pod 间网络通信正常</li></ol><h3 id="🔧-故障排查"><a href="#🔧-故障排查" class="headerlink" title="🔧 故障排查"></a>🔧 故障排查</h3><h4 id="Pod-启动失败"><a href="#Pod-启动失败" class="headerlink" title="Pod 启动失败"></a>Pod 启动失败</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 检查 Pod 状态</span><br>kubectl describe pod minio-0 -n satellite-micro<br><br><span class="hljs-comment"># 查看事件</span><br>kubectl get events -n satellite-micro --sort-by=<span class="hljs-string">&#x27;.lastTimestamp&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="PVC-绑定失败"><a href="#PVC-绑定失败" class="headerlink" title="PVC 绑定失败"></a>PVC 绑定失败</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 检查存储类</span><br>kubectl get storageclass<br><br><span class="hljs-comment"># 检查 PVC 状态</span><br>kubectl describe pvc data-minio-0 -n satellite-micro<br></code></pre></td></tr></table></figure><h4 id="网络连接问题"><a href="#网络连接问题" class="headerlink" title="网络连接问题"></a>网络连接问题</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 测试 Pod 间网络</span><br>kubectl <span class="hljs-built_in">exec</span> -it minio-0 -n satellite-micro -- nslookup minio-1.minio-hl-svc.satellite-micro.svc.cluster.local<br></code></pre></td></tr></table></figure><h3 id="📊-性能优化建议"><a href="#📊-性能优化建议" class="headerlink" title="📊 性能优化建议"></a>📊 性能优化建议</h3><ol><li><strong>节点分布</strong>：使用 <code>podAntiAffinity</code> 确保 Pod 分布在不同节点</li><li><strong>存储优化</strong>：根据 I&#x2F;O 需求选择合适的存储类</li><li><strong>资源限制</strong>：为容器设置合适的 CPU 和内存限制</li><li><strong>网络优化</strong>：使用 CNI 插件优化网络性能</li></ol><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://www.cnblogs.com/Leonardo-li/p/18743772">k8s离线部署minio集群</a></li><li><a href="https://cloud.tencent.com/developer/article/2246499">kubernetes安装minio集群</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>DevOps &amp; 云原生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MinIO</tag>
      
      <tag>Kubernetes</tag>
      
      <tag>分布式存储</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MinIO 分布式部署（Docker）</title>
    <link href="/2025/09/05/MinIO-%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%EF%BC%88Docker%EF%BC%89/"/>
    <url>/2025/09/05/MinIO-%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%EF%BC%88Docker%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>MinIO集群构建 + Docker容器化部署 + Nginx负载均衡</p><blockquote><p>⚠️ <strong>注意</strong>：MinIO 官方推荐 Kubernetes 云原生部署方式，不提供也不支持采用各种容器化部署集群的途径。</p></blockquote><h2 id="📋-目录"><a href="#📋-目录" class="headerlink" title="📋 目录"></a>📋 目录</h2><ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2">为什么选择分布式部署？</a></li><li><a href="#%E9%83%A8%E7%BD%B2%E5%89%8D%E5%87%86%E5%A4%87">部署前准备</a></li><li><a href="#minio-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AE%B9%E5%99%A8%E5%8C%96%E9%83%A8%E7%BD%B2">MinIO 分布式容器化部署</a></li><li><a href="#nginx-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%85%8D%E7%BD%AE">Nginx 负载均衡配置</a></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</a></li></ul><h2 id="为什么选择分布式部署？"><a href="#为什么选择分布式部署？" class="headerlink" title="为什么选择分布式部署？"></a>为什么选择分布式部署？</h2><p>MinIO 单体应用并不能发挥 MinIO 自带分布式存储的优势：</p><ul><li>✅ <strong>数据容灾</strong>：多节点备份，防止数据丢失</li><li>✅ <strong>负载均衡</strong>：分散请求压力，提高性能</li><li>✅ <strong>高可用性</strong>：避免单点故障，确保服务稳定运行</li></ul><blockquote><p>⚠️ <strong>注意</strong>：单节点部署难免会出现单点故障，无法做到服务的高可用</p></blockquote><h2 id="部署前准备"><a href="#部署前准备" class="headerlink" title="部署前准备"></a>部署前准备</h2><h3 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h3><ul><li>MinIO 官方建议采用 <strong>Kubernetes</strong> 部署</li><li>确保所有节点的 <strong>MinIO 版本一致</strong></li><li>建议使用 4 个或更多节点以获得最佳性能</li></ul><h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><h4 id="1-获取节点-IP-地址"><a href="#1-获取节点-IP-地址" class="headerlink" title="1. 获取节点 IP 地址"></a>1. 获取节点 IP 地址</h4><p>在每个节点上执行以下命令获取内网 IP：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ip addr<br></code></pre></td></tr></table></figure><blockquote><p>💡 <strong>提示</strong>：阿里云服务器请勿采用公网 IP，使用内网 IP 更安全且性能更好</p></blockquote><h4 id="2-配置主机名解析"><a href="#2-配置主机名解析" class="headerlink" title="2. 配置主机名解析"></a>2. 配置主机名解析</h4><p>在每个节点的 <code>/etc/hosts</code> 文件中添加以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">172.17.117.117 minio-1  <br>172.17.117.118 minio-2  <br>172.17.117.119 minio-3  <br>172.17.117.120 minio-4<br></code></pre></td></tr></table></figure><h4 id="3-测试网络连通性"><a href="#3-测试网络连通性" class="headerlink" title="3. 测试网络连通性"></a>3. 测试网络连通性</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ping minio-1<br>ping minio-2<br>ping minio-3<br>ping minio-4<br></code></pre></td></tr></table></figure><h2 id="MinIO-分布式容器化部署"><a href="#MinIO-分布式容器化部署" class="headerlink" title="MinIO 分布式容器化部署"></a>MinIO 分布式容器化部署</h2><h3 id="启动-MinIO-容器"><a href="#启动-MinIO-容器" class="headerlink" title="启动 MinIO 容器"></a>启动 MinIO 容器</h3><p>在每个节点上运行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --name minio --net=host --restart=always --privileged=<span class="hljs-literal">true</span> -v /mnt/minio/data:/data -e MINIO_ROOT_USER=OGMS -e MINIO_ROOT_PASSWORD=ogms250410 minio/minio:latest server http://minio-&#123;1...4&#125;/data --console-address <span class="hljs-string">&quot;0.0.0.0:9101&quot;</span> --address <span class="hljs-string">&quot;0.0.0.0:9100&quot;</span><br></code></pre></td></tr></table></figure><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>--net=host</code></td><td>共享宿主机网络命名空间</td></tr><tr><td><code>--restart=always</code></td><td>容器自动重启</td></tr><tr><td><code>--privileged=true</code></td><td>给予容器特权模式</td></tr><tr><td><code>-v /mnt/minio/data:/data</code></td><td>数据持久化挂载</td></tr><tr><td><code>MINIO_ROOT_USER</code></td><td>MinIO 管理员用户名</td></tr><tr><td><code>MINIO_ROOT_PASSWORD</code></td><td>MinIO 管理员密码</td></tr><tr><td><code>--console-address</code></td><td>控制台访问地址</td></tr><tr><td><code>--address</code></td><td>API 访问地址</td></tr></tbody></table><h3 id="检查容器状态"><a href="#检查容器状态" class="headerlink" title="检查容器状态"></a>检查容器状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker logs minio<br></code></pre></td></tr></table></figure><h2 id="Nginx-负载均衡配置"><a href="#Nginx-负载均衡配置" class="headerlink" title="Nginx 负载均衡配置"></a>Nginx 负载均衡配置</h2><h3 id="启动-Nginx-容器"><a href="#启动-Nginx-容器" class="headerlink" title="启动 Nginx 容器"></a>启动 Nginx 容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --name minio_nginx --net=host -p 9000:9000 -p 9001:9001 -v /mnt/nginx/conf/nginx.conf:/etc/nginx/nginx.conf --restart=always --privileged=<span class="hljs-literal">true</span> nginx:latest<br><br><span class="hljs-comment"># 或者使用 ARM 版本</span><br><span class="hljs-comment"># nginx:alpine-arm</span><br></code></pre></td></tr></table></figure><h3 id="Nginx-配置文件"><a href="#Nginx-配置文件" class="headerlink" title="Nginx 配置文件"></a>Nginx 配置文件</h3><p>创建 <code>/mnt/nginx/conf/nginx.conf</code> 文件：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">worker_processes</span> auto;  <br><br><span class="hljs-section">events</span> &#123;  <br>    <span class="hljs-attribute">worker_connections</span> <span class="hljs-number">1024</span>;  <br>&#125;  <br><br><span class="hljs-section">http</span> &#123;  <br>    <span class="hljs-comment"># API 负载均衡  </span><br>    <span class="hljs-section">upstream</span> minio_api &#123;  <br>        ip_hash;   <span class="hljs-comment"># 使用 ip_hash，保证同一个客户端尽量落到同一节点，避免会话不一致  </span><br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">1</span>:<span class="hljs-number">9100</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">30s</span>;  <br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">2</span>:<span class="hljs-number">9100</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">30s</span>;  <br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">3</span>:<span class="hljs-number">9100</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">30s</span>;  <br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">4</span>:<span class="hljs-number">9100</span> max_fails=<span class="hljs-number">3</span> fail_timeout=<span class="hljs-number">30s</span>;  <br>    &#125;  <br><br>    <span class="hljs-comment"># 控制台负载均衡  </span><br>    <span class="hljs-section">upstream</span> minio_console &#123;  <br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">1</span>:<span class="hljs-number">9101</span>;  <br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">2</span>:<span class="hljs-number">9101</span>;  <br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">3</span>:<span class="hljs-number">9101</span>;  <br>        <span class="hljs-attribute">server</span> minio-<span class="hljs-number">4</span>:<span class="hljs-number">9101</span>;  <br>    &#125;  <br><br>    <span class="hljs-comment"># MinIO API 服务</span><br>    <span class="hljs-section">server</span> &#123;  <br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">9000</span>;  <br>        <span class="hljs-attribute">server_name</span> _;  <br><br>        <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">0</span>;  <br>        <span class="hljs-attribute">proxy_buffering</span> <span class="hljs-literal">off</span>;  <br>        <span class="hljs-attribute">ignore_invalid_headers</span> <span class="hljs-literal">off</span>;  <br><br>        <span class="hljs-section">location</span> / &#123;  <br>            <span class="hljs-attribute">proxy_set_header</span> Host              <span class="hljs-variable">$http_host</span>;  <br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP         <span class="hljs-variable">$remote_addr</span>;  <br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For   <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;  <br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;  <br><br>            <span class="hljs-attribute">proxy_connect_timeout</span> <span class="hljs-number">300</span>;  <br>            <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;  <br>            <span class="hljs-attribute">chunked_transfer_encoding</span> <span class="hljs-literal">off</span>;  <br>            <span class="hljs-attribute">proxy_ignore_client_abort</span> <span class="hljs-literal">on</span>;  <br><br>            <span class="hljs-attribute">proxy_pass</span> http://minio_api;  <br>        &#125;  <br>    &#125;  <br><br>    <span class="hljs-comment"># MinIO Console 服务</span><br>    <span class="hljs-section">server</span> &#123;  <br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">9001</span>;  <br>        <span class="hljs-attribute">server_name</span> _;  <br><br>        <span class="hljs-section">location</span> / &#123;  <br>            <span class="hljs-attribute">proxy_set_header</span> Host              <span class="hljs-variable">$http_host</span>;  <br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP         <span class="hljs-variable">$remote_addr</span>;  <br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For   <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;  <br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;  <br><br>            <span class="hljs-attribute">proxy_pass</span> http://minio_console;  <br>        &#125;  <br>    &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h3 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h3><h4 id="负载均衡策略"><a href="#负载均衡策略" class="headerlink" title="负载均衡策略"></a>负载均衡策略</h4><ul><li><strong>API 服务</strong>：使用 <code>ip_hash</code> 策略，确保同一客户端请求路由到同一节点</li><li><strong>控制台服务</strong>：使用轮询策略，分散访问压力</li></ul><h4 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h4><table><thead><tr><th>服务</th><th>端口</th><th>说明</th></tr></thead><tbody><tr><td>MinIO API</td><td>9000</td><td>对象存储 API 接口</td></tr><tr><td>MinIO Console</td><td>9001</td><td>Web 管理控制台</td></tr></tbody></table><h2 id="🎯-部署完成"><a href="#🎯-部署完成" class="headerlink" title="🎯 部署完成"></a>🎯 部署完成</h2><p>部署完成后，你可以通过以下方式访问：</p><ul><li><strong>API 接口</strong>：<code>http://your-server:9000</code></li><li><strong>管理控制台</strong>：<code>http://your-server:9001</code></li></ul><p>使用配置的用户名和密码登录管理控制台，开始使用 MinIO 分布式存储服务！</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://www.cnblogs.com/sunxun001/p/17420785.html">MinIO 分布式部署实践</a></li><li><a href="https://www.cnblogs.com/masonlee/p/12811784.html">MinIO 集群部署指南</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>DevOps &amp; 云原生</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>MinIO</tag>
      
      <tag>分布式存储</tag>
      
      <tag>Nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue Composables - 组合式函数的应用</title>
    <link href="/2025/08/09/Vue-Composables-%E7%BB%84%E5%90%88%E5%BC%8F%E5%87%BD%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <url>/2025/08/09/Vue-Composables-%E7%BB%84%E5%90%88%E5%BC%8F%E5%87%BD%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>Vue3 带来最大的革新莫过于选项式API (<code>Composition API</code>), 其中一大特性就是<code>组合式函数</code>。在 Vue 生态中，composables 一般翻译成 “组合式函数” 或 “可组合函数”, 意思是把一段逻辑（通常是响应式状态、计算属性、侦听器等）封装成一个独立的函数，这个函数可以在多个组件中复用, 也可以用于解耦臃肿的业务逻辑。</p><p><strong>作用：逻辑复用、代码组织更清晰，不依赖组件上下文</strong></p><h2 id="一个简单的组合式函数样例"><a href="#一个简单的组合式函数样例" class="headerlink" title="一个简单的组合式函数样例"></a>一个简单的组合式函数样例</h2><h3 id="创建-useGrid-ts-文件"><a href="#创建-useGrid-ts-文件" class="headerlink" title="创建 useGrid.ts 文件"></a>创建 useGrid.ts 文件</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; computed, ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span><br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">Grid</span> = &#123;<br>    <span class="hljs-attr">columnId</span>: <span class="hljs-built_in">number</span>,<br>    <span class="hljs-attr">rowId</span>: <span class="hljs-built_in">number</span>,<br>    <span class="hljs-attr">resolution</span>: <span class="hljs-built_in">number</span><br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useGrid</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> columnId = ref&lt;<span class="hljs-built_in">number</span>&gt;()<br>    <span class="hljs-keyword">const</span> rowId = ref&lt;<span class="hljs-built_in">number</span>&gt;()<br>    <span class="hljs-keyword">const</span> resolution = ref&lt;<span class="hljs-built_in">number</span>&gt;()<br>    <span class="hljs-keyword">const</span> selectedGrid = ref&lt;<span class="hljs-title class_">Grid</span>&gt;()<br><br>    <span class="hljs-keyword">const</span> <span class="hljs-title function_">getAllGrid</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>        <span class="hljs-comment">// 在这里封装具体的函数逻辑</span><br>        ...<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        selectedGrid,<br>        getAllGrid<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="在你的代码中应用"><a href="#在你的代码中应用" class="headerlink" title="在你的代码中应用"></a>在你的代码中应用</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        一个简单的组合式函数样例🚀<br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>当前选中的格网：&#123;&#123; selectedGrid &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; useGrid &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./useGrid.ts&quot;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> &#123; selectedGrid, getAllGrid &#125; = <span class="hljs-title function_">useGrid</span>() <span class="hljs-comment">// 记住这种写法！对象解耦</span></span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="等同于："><a href="#等同于：" class="headerlink" title="等同于："></a>等同于：</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        一个简单的非组合式函数样例<br>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>当前选中的格网：&#123;&#123; selectedGrid &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; computed, ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span></span><br><span class="language-javascript"></span><br><span class="language-javascript">type <span class="hljs-title class_">Grid</span> = &#123;</span><br><span class="language-javascript">    <span class="hljs-attr">columnId</span>: number,</span><br><span class="language-javascript">    <span class="hljs-attr">rowId</span>: number,</span><br><span class="language-javascript">    <span class="hljs-attr">resolution</span>: number</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> columnId = ref&lt;number&gt;()</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> rowId = ref&lt;number&gt;()</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> resolution = ref&lt;number&gt;()</span><br><span class="language-javascript"><span class="hljs-keyword">const</span> selectedGrid = ref&lt;<span class="hljs-title class_">Grid</span>&gt;()</span><br><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getAllGrid</span> = (<span class="hljs-params"></span>) =&gt; &#123;</span><br><span class="language-javascript">    <span class="hljs-comment">// 在这里封装具体的函数逻辑</span></span><br><span class="language-javascript">    ...</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="组合式函数的好处"><a href="#组合式函数的好处" class="headerlink" title="组合式函数的好处"></a>组合式函数的好处</h2><p>大家可以发现，组合式函数能够将你的业务逻辑从原本臃肿的代码中抽象解放出来！以便于逻辑复用，同时代码组织更加清晰，不依赖组件上下文</p><h2 id="组合式函数的“陷阱”"><a href="#组合式函数的“陷阱”" class="headerlink" title="组合式函数的“陷阱”"></a>组合式函数的“陷阱”</h2><h3 id="选项式-API-作用域范围混淆——案例1"><a href="#选项式-API-作用域范围混淆——案例1" class="headerlink" title="选项式 API 作用域范围混淆——案例1"></a>选项式 API 作用域范围混淆——案例1</h3><p>大家可以思考一下以下两种写法有什么不同？</p><ul><li>写法1</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// useGrid.ts</span><br><span class="hljs-keyword">import</span> &#123; computed, ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useGrid</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-comment">// 把响应式变量封装入组合式函数内部</span><br>    <span class="hljs-keyword">const</span> columnId = ref&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        columnId<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// test.ts</span><br><span class="hljs-keyword">import</span> &#123; useGrid &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./useGrid.ts&quot;</span><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">columnId</span>: columnIdA &#125; = <span class="hljs-title function_">useGrid</span>() <span class="hljs-comment">// :相当于以columnIdA的变量名引入columnId</span><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">columnId</span>: columnIdB &#125; = <span class="hljs-title function_">useGrid</span>()<br><br>columnIdA.<span class="hljs-property">value</span> ++<br>columnIdB.<span class="hljs-property">value</span> ++<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(columnIdA.<span class="hljs-property">value</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(columnIdB.<span class="hljs-property">value</span>)<br></code></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">1<br>1<br></code></pre></td></tr></table></figure><ul><li>写法2</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// useGrid.ts</span><br><span class="hljs-keyword">import</span> &#123; computed, ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span><br><br><span class="hljs-keyword">const</span> columnId = ref&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useGrid</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>        columId<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// test.ts</span><br><span class="hljs-keyword">import</span> &#123; useGrid &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./useGrid.ts&quot;</span><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">columnId</span>: columnIdA &#125; = <span class="hljs-title function_">useGrid</span>() <span class="hljs-comment">// :相当于以columnIdA的变量名引入columnId</span><br><span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">columnId</span>: columnIdB &#125; = <span class="hljs-title function_">useGrid</span>()<br><br>columnIdA.<span class="hljs-property">value</span> ++<br>columnIdB.<span class="hljs-property">value</span> ++<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(columnIdA.<span class="hljs-property">value</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(columnIdB.<span class="hljs-property">value</span>)<br></code></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">1<br>2<br></code></pre></td></tr></table></figure><p>为什么会造成这种差异呢？</p><p>因为写法1把columnId这个响应式变量作为了组合函数封装的一部分，而写法2则把columnId作为了全局变量。在写法1的情况下，利用useGrid声明的两个响应式变量是双胞胎兄弟，它们本质上是不同的个体！而写法2虽然也声明了两个响应式变量，但本质上两个响应式变量指向的是同一个变量。</p><p>这两种做法各有什么实际用处呢？</p><p>写法1更适用于“逻辑复用”，在不同的地方声明useGrid，也即在不同的业务场景应用组合式函数，他们需要的是独立的响应式变量，不需要共享给其他组件。<br>而写法2更适用于“共享”，在不同的地方声明useGrid，它们可以拿到同一份响应式变量，需要的是能在不同的业务场景中共享一份数据。</p><h3 id="选项式API作用域范围混淆——案例2"><a href="#选项式API作用域范围混淆——案例2" class="headerlink" title="选项式API作用域范围混淆——案例2"></a>选项式API作用域范围混淆——案例2</h3><p>前情提要：useI18n是一个只能作用于选项式API范围内的组合式函数</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// useA.ts</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useA</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> &#123; t &#125; = <span class="hljs-title function_">useI18n</span>()<br>    ...<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        ...<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">//useB.ts</span><br><span class="hljs-keyword">import</span> &#123; useA &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./useA.ts&#x27;</span><br><span class="hljs-keyword">const</span> &#123; ... &#125; = <span class="hljs-title function_">useA</span>()<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useB</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    ...<br>    <span class="hljs-keyword">return</span> &#123;<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>vue组件测试</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">import</span> &#123; useB &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./useB.ts&#x27;</span></span><br><span class="language-javascript"><span class="hljs-keyword">const</span> &#123; ... &#125; = <span class="hljs-title function_">useB</span>()</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>这是另一种作用域混淆错误，因为useA中useI18n只能在选项式API内声明，而useB中却在组合式函数外部声明useA，这本质上脱离了选项式API的作用域，故vue组件就会报错useI18n必须在选项式API内部声明。</p><h3 id="注意规避循环依赖"><a href="#注意规避循环依赖" class="headerlink" title="注意规避循环依赖"></a>注意规避循环依赖</h3><p>有的时候我们喜欢混用各个组合式函数，组合式函数之间可能存在相互引用的变量，就会造成循环依赖，故在设计时就要将各个模块解耦开，另外推荐一种笔者推荐的写法，可以有效避免循环依赖：</p><h3 id="笔者推荐的写法"><a href="#笔者推荐的写法" class="headerlink" title="笔者推荐的写法"></a>笔者推荐的写法</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">// 创建 shared.ts</span><br><span class="hljs-keyword">import</span> &#123; ref &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> commonVar = ref&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment">// useA.ts</span><br><span class="hljs-keyword">import</span> &#123; commonVar &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./shared.ts&#x27;</span><br>... <span class="hljs-comment">// 使用commonVar</span><br><span class="hljs-comment">// useB.ts</span><br><span class="hljs-keyword">import</span> &#123; commonVar &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./shared.ts&#x27;</span><br>... <span class="hljs-comment">// 使用commonVar</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Web前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
      <tag>组合式函数</tag>
      
      <tag>选项式API</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2025/08/03/hello-world/"/>
    <url>/2025/08/03/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
